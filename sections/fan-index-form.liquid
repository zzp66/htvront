{% if request.page_type == 'article' or request.page_type == 'blog' %}
  {% capture permalinkURL %}{{ shop.url }}{{ article.url }}{% endcapture %}
  {% capture shareTitle %}{{ article.title | url_param_escape }}{% endcapture %}
{% elsif request.page_type == 'product' %}
  {% capture permalinkURL %}{{ shop.url }}{{ product.url }}{% endcapture %}
  {% capture shareTitle %}{{ product.title | url_param_escape }}{% endcapture %}
{% elsif request.page_type == 'page' %}
  {% capture permalinkURL %}{{ shop.url }}{{ page.url }}{% endcapture %}
  {% capture shareTitle %}{{ page.title | url_param_escape }}{% endcapture %}
{% elsif request.page_type == 'collection' %}
  {% capture permalinkURL %}{{ shop.url }}{{ collection.url }}{% endcapture %}
  {% capture shareTitle %}{{ page.title | url_param_escape }}{% endcapture %}
{% elsif request.page_type == 'index' %}
  {% capture permalinkURL %}{{ shop.url }}{% endcapture %}
  {% capture shareTitle %}{{ page.title | url_param_escape }}{% endcapture %}
{% elsif request.page_type == 'password' %}
  {% capture permalinkURL %}{{ shop.url }}{% endcapture %}
  {% capture shareTitle %}{% unless shop.metafields.global.description_tag == blank %}{{ shop.metafields.global.description_tag | url_param_escape }}{% else %}{{ shop.name | url_param_escape }}{% endunless %}{% endcapture %}
{% endif %}
<style>
  .index-loading-overlay__spinner{
    width: 1.8rem;
    display: inline-block;
  }
  .index-loading-overlay__spinner{
    display:none
  }
  .index-loading-overlay__spinner .spinner{
    vertical-align:middle
  }
</style>
<div>
  <!--
    <img
      class="fan-enroll-img-pc"
      src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/img_v2_aff79b81-65cb-4210-85e5-5cb8d3662a1g_MIDDLE.png?v=1678323074"
    >
    <img
      class="fan-enroll-img-mobile"
      src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/img_v2_aff79b81-65cb-4210-85e5-5cb8d3662a1g_MIDDLE_img_v2_788205e4-9c5c-4021-91b1-2ce8b59bff4g_MIDDLE.png?v=1679033444"
    >
  -->
  <div class="fan-enroll-content">
    <div class="fan-enroll-introduction">
      <div class="fan-enroll-title">Share to Unlock Exclusive Bonus</div>
      <div>
        <p class="fan-enroll-text">Details:</p>
        <ul class="fan-enroll-step">
          <li>
            <div class="fan-enroll-share-content">
              <p class="fan-enroll-text">
                Step 1:Share the Fans Carnival link to the following social media, @HTVRONT.
                <a
                  target="_blank"
                  href="//www.facebook.com/sharer.php?u={{ permalinkURL }}&title='The 2nd HTVRONT Fans Carnival'"
                  class="share-facebook"
                  title="{{ 'The 2nd HTVRONT Fans Carnival@HTVRONT' | t }}"
                >
                  <img
                    class="fan-enroll-share-icon"
                    src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/img_v2_330b376d-885a-42ab-a7b8-44a7491d07ag.png?v=1678692759"
                    alt=""
                  >
                </a>

                <a
                  target="_blank"
                  href="https://www.instagram.com?u={{ permalinkURL }}&title='The 2nd HTVRONT Fans Carnival'@HTVRONT"
                  title="{{ 'The 2nd HTVRONT Fans Carnival@HTVRONT' }}"
                  class="share-pinterest"
                  target="_blank"
                  aria-describedby="a11y-new-window-external-message"
                >
                  <img
                    class="fan-enroll-share-icon"
                    src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/img_v2_13f37c31-b718-4166-b05b-70116a72324g_MIDDLE.png?v=1678692759"
                    alt=""
                  >
                </a>
                <a
                  target="_blank"
                  href="https://vt.tiktok.com/share"
                  title="{{ 'The 2nd HTVRONT Fans Carnival@HTVRONT' }}"
                  class="share-pinterest"
                  target="_blank"
                  aria-describedby="a11y-new-window-external-message"
                >
                  <img
                    class="fan-enroll-share-icon"
                    src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/img_v2_fbde4bc5-2a03-4adc-9a53-7d9160f4e57g.png?v=1678692823"
                    alt=""
                  >
                </a>
              </p>
            </div>
          </li>
          <li>
            <p class="fan-enroll-text">
              Step 2:Take a screenshot of your post and submit it below. We will send you the bonus after review.
            </p>
          </li>
          <li>
            <p class="fan-enroll-text">Step 3:Click "Add to cart," and you will get the bonus alongside your orders.</p>
          </li>
        </ul>
      </div>
    </div>
    <div class="fan-enroll-form">
      <div class="fan-enroll-small-title">Submit Your Screenshots</div>
      <form id="indexForm">
        <div class="fan-enroll-form-item">
          <div class="fan-enroll-form-name">
            <label class="fan-enroll-form-label">Name</label>
            <input class="fan-enroll-form-input" type="text" id="indexName" name="name">
            <span class="fan-enroll-form-rule">*Please fill in Name</span>
          </div>
          <div class="fan-enroll-form-email">
            <label class="fan-enroll-form-label">Email</label>
            <input class="fan-enroll-form-input" type="text" id="indexEmail" name="email">
            <span class="fan-enroll-form-rule">*Please fill in Email</span>
          </div>
        </div>

        <div class="fan-enroll-form-upload">
          <label class="fan-enroll-form-label">Upload shared screenshots</label>
          <div class="fan-form-upload">
            <p class="fan-enroll-form-upload-text">+upload files</p>
            <input class="fan-enroll-form-upload-con" type="file" id="indexUpload" name="upload">
            <p class="fan-enroll-form-upload-name"></p>
          </div>
          <div class="uploaderTips">
            <span class="fan-enroll-form-rule">*Please upload shared screenshots</span>
            <span></span>
            <p class="fan-enroll-upload-tips">JPG PNG I Each file cannot exceed 5MB</p>
          </div>
        </div>
        <div class="fan-enroll-form-submit">
          <p class="fan-index-form-button">Submit</p>
          <div class="index-loading-overlay__spinner">
            <svg
              aria-hidden="true"
              focusable="false"
              role="presentation"
              class="spinner"
              viewBox="0 0 66 66"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
            </svg>
          </div>
        </div>
        <span class="fan-form-error">*Submission failed, please check your network or upload again</span>
      </form>
    </div>
  </div>
  <img
    class="fan-enroll-form-close"
    src="https://cdn.shopifycdn.net/s/files/1/0356/5997/2741/files/ff5587b3fa653dff6fc130c810c9cedd.png?v=1678344980"
  >
</div>
<script>
   
  $(function(){
    $("#indexUpload").change(function () {
        var s = $('#indexUpload').val();
        var start = s.indexOf(".") + 1;
        var name = s.substring(start, s.length).toLowerCase();
        if (name != "jpg" && name != "png" && name != "gif" && name != "jpeg" && name != "bmp") {
            $('.fan-enroll-form-upload .fan-enroll-form-rule').text('*Supported: JPG and PNG. The image cannot exceed 5MB').show()
            return;
        }
        if (this.files[0].size / 1024 / 1024 > 5) {
            $('.fan-enroll-form-upload .fan-enroll-form-rule').text('*Supported: JPG and PNG. The image cannot exceed 5MB').show()
            return;
        }
        $('.fan-indexForm .fan-enroll-form-upload .fan-enroll-form-rule').hide()
        $('.fan-indexForm .fan-enroll-form-upload-text').hide()
        $('.fan-indexForm .fan-enroll-form-upload-name').text(this.files[0].name).show()
        $('.fan-form-upload').removeClass('border-color-red')
    })
  })
  
    let isButton = true
        // 分享弹窗提交事件
    $('.fan-enroll-form-submit').click(function(){
      if(!isButton) return
          var name = $('#indexName').val()
          var email = $('#indexEmail').val()
          if(name=='' || email=='' || $('#indexUpload').val()==''){
             if(name==''){
                $('.fan-enroll-form-name .fan-enroll-form-input').addClass('border-color-red')
                $('.fan-enroll-form-name .fan-enroll-form-rule').text('*Please enter your Name').show()
              }else{
                $('.fan-enroll-form-name .fan-enroll-form-input').removeClass('border-color-red')
                $('.fan-enroll-form-name .fan-enroll-form-rule').hide()
              }
              if(email==''){
                $('.fan-enroll-form-email .fan-enroll-form-input').addClass('border-color-red')
                $('.fan-enroll-form-email .fan-enroll-form-rule').text('*Please enter your Email').show()
              }else{
                $('.fan-enroll-form-email .fan-enroll-form-input').removeClass('border-color-red')
                $('.fan-enroll-form-email .fan-enroll-form-rule').hide()
              }
              if($('#indexUpload').val()==''){
                $('.fan-form-upload').addClass('border-color-red')
                $('.fan-enroll-form-upload .fan-enroll-form-rule').text('*Please upload your screenshots of link sharing post').show()
                $('.fan-enroll-form-upload .fan-enroll-form-upload-text').addClass('font-color-red')
              }else{
                $('.fan-form-upload').removeClass('border-color-red')
                $('.fan-enroll-form-upload .fan-enroll-form-rule').hide()
                $('.fan-enroll-form-upload .fan-enroll-form-upload-text').removeClass('font-color-red')
              }
          }else{
            indexFormSet()
            var reg=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
            if(!reg.test(email)){
                $('.fan-enroll-form-email .fan-enroll-form-input').addClass('border-color-red')
                $('.fan-enroll-form-email .fan-enroll-form-rule').text('*Please enter the correct email address').show()
            }else{
              $('.fan-enroll-form-email .fan-enroll-form-input').removeClass('border-color-red')
              $('.fan-enroll-form-email .fan-enroll-form-rule').hide()
              var files = $('#indexUpload')[0].files[0]
              let file = new Blob([files], {type: files.type})
              var formData = new FormData();
               formData.append('file',files);
               formData.append('name',name);
               formData.append('email',email);
               formData.append('tag',1);
               formData.append('site','US')
              isButton = false
             $('.index-loading-overlay__spinner').show()
             $('.fan-index-form-button').hide()
               $.ajax({
                     url: 'https://qn.htvront.com:9000/prod-biz-api/htvront/fansFeast/upload',
                     type:'POST',
                     data: formData,
                     processData:false,
                     dataType:'json',
                     contentType: false,
                     cache: false,
                     success(result){
                       isButton = true
                       $('.index-loading-overlay__spinner').hide()
                       $('.fan-index-form-button').show()
                             $('.fan-indexForm').hide()
                             $('.fan-form-error').hide()
                             $('.Fan-Prediction-Gift').show();
                           $('#indexForm')[0].reset()
                       },
                       error(result){  
                         isButton = true
                         $('.index-loading-overlay__spinner').hide()
                         $('.fan-index-form-button').show()
                         let res = result.responseText.split('(').join('')
                         let reses = res.split(')').join('')
                         if(JSON.parse(reses).status == 200){
                           $('#indexForm')[0].reset()
                             $('.fan-indexForm').hide()
                             $('.fan-form-error').hide()
                             $('.Fan-Prediction-Gift').show();
                         }else{
                           $('.fan-form-error').show()
                         }
                      }
              })
            }
          }
      })

function indexFormSet(){
  $('.fan-enroll-form-name .fan-enroll-form-input').removeClass('border-color-red')
            $('.fan-enroll-form-name .fan-enroll-form-rule').hide()
            $('.fan-enroll-form-email .fan-enroll-form-input').removeClass('border-color-red')
            $('.fan-enroll-form-email .fan-enroll-form-rule').hide()
            $('.fan-form-upload').removeClass('border-color-red')
            $('.fan-enroll-form-upload .fan-enroll-form-upload-text').removeClass('font-color-red')
            $('.fan-enroll-form-upload .fan-enroll-form-rule').hide()
}

</script>
{% schema %}
{
  "name": "fan-index-form",
  "settings": []
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
