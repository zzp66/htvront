{%- style -%}
.lading-box .dialog {
  width:1000px;
  position: fixed;
  top: 53%;
  left: 50%;
  transform: translate(-50%,-50%);
  border:1px solid #eee;
  border-radius: 10px;
  background:#fff;
}
.container { 
width: 100%;
margin: 0 auto;
text-align: center;
}

.options {
align-items: center;
display: flex;
justify-content: space-between;
flex-wrap: wrap;
}

.option {
display: inline-block;
cursor: pointer;
display: flex;
flex-direction: column;
align-items: center;
width: 276px;
justify-content: center;
height:184px;
margin-bottom: 20px;
box-shadow: 0px 4px 14px 0px rgba(0,0,0,0.04);
}

.option label {
text-align: center;
cursor: pointer;
height: 100%;
width: 100%;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
}
.option img {
width: fit-content;
  max-height: 80%;
  padding:10px 10px 7px;
}
.option div {
font-weight: bold;
}

.option input[type="checkbox"] {
display: none;
}

.highlight {
border: 2px solid #5AB48C;
border-radius: 10px;
}

#NextBtn {
width: 188px;
height: 44px;
background: #33B77B;
border-radius: 6px;
color: #fff;
font-size: 18px;
line-height: 44px;
border: none;
cursor: pointer;
}
/* ------------- */
.form-commit {
padding: 40px 55px 60px;
}
.form-commit .progress-bar-progress {
font-weight: bold;
font-size: 16px;
text-align: right;
color: #3BC888;
}
.form-commit .progress-bar-text {
font-size: 16px;
line-height: 22px;
font-weight: bold;
margin-bottom: 10px;
}
.form-commit .progress-bar {
height: 10px;
display: flex;
justify-content: center;
align-items: center;
width: 100%;
margin: 0 auto;
background-color: #96D8BA;
border-radius: 10px;
}
.form-commit .progress-bar .progress-bar-one {
height: 100%;
width:50%;
background-color: #3BC888;
border-top-left-radius: 10px;
border-bottom-left-radius: 10px;
}
.form-commit .progress-bar .progress-bar-two {
background-color: #96D8BA;
width:50%;
height: 100%;
border-top-right-radius: 10px;
border-bottom-right-radius: 10px;
}
.form-commit .dialogTitle{
text-align: center;
font-size: 22px;
font-weight: bold;
margin-bottom: 18px;
}
.form-commit .dialog-close{
position: absolute;
right: 38px;
top: 38px;
cursor: pointer;
}
.question {
text-align: center;
width: 100%;
}
.question ul {
list-style: none;
padding: 0;
display: flex;
flex-wrap: wrap;
justify-content: space-between;
margin-top: 20px;
}
.question li {
display: inline-block;
width: 200px;
cursor: pointer;
max-height: 184px;
box-shadow: 0px 4px 14px 0px rgba(0,0,0,0.04);
margin-bottom: 30px;
border-radius: 10px;
    &:last-child:nth-child(4n - 1) {
      margin-right: 25%;
    }
    &:last-child:nth-child(4n - 2) {
      margin-right: calc(50% + 5px);
    }
}
.question li span {
  font-weight: bold;    
}
.question li img {
width: 100%;
padding: 10px 10px 7px;
}
.question li.selected {
background-color: #00bcd4;
color: #fff;
}
.question li.disabled {
background-color: #ccc;
color: #fff;
cursor: not-allowed;
}
#submitBtn {
width: 188px;
height: 44px;
background: #33B77B;
border-radius: 6px;
color: #fff;
border: none;
font-size: 18px;
cursor: pointer;
margin-top: 10px;
}
.active {
display: none;
}
.btn-box {
width:100%;
}
.blindBoxTwo-text {
  color:#5AB48C;
}
.dialog {
  display:none;
}
.blind-banner {
  width:100%;
  position: relative;
}
.blind-banner .goNonEvaluation,.goEvaluation {
  width:185px;
  height:44px;
  background:{{section.settings.btnBagColor}};
  text-align: center;
  border-radius: 22px;
  border: 1px solid #000000;
  color:{{section.settings.btnTextColor}};
  cursor: pointer;
  font-size: 18px;
}
.blind-banner .banner-box {
  position: absolute;
  left: 28%;
  bottom: 3%;
  width: auto;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.blind-banner .banner-box .blind-banner-text {
  color:{{section.settings.btnBagColor}};
  font-size: 18px;
  width: 490px;
  text-align: center;
  margin-bottom: 10px;
  font-weight: bold;
}
.blind-banner .btn-box {
  width: auto;
  display: flex;
}
.blind-banner .goEvaluation{
  margin-right: 20px;
}
.blind-banner .blind-banner-small-img {
  display:none;
}
.blind-banner .blind-banner-small-img img{
  width:100%;
}
.btn-box-NextBtn {
  width:100%;
  margin-top: 20px;
}
{%- endstyle -%}

{%- style -%}
@media screen and (max-width: 1660px) {
  .blind-banner .banner-box {
    transform: translate(-50%, -30%);
  }
  .lading-box .dialog {
    top:56%;
  }
}
@media screen and (max-width: 1440px) {
  .blind-banner .banner-box {
  transform: translate(-45%, -15%);
}
  .blind-banner .banner-box .blind-banner-text {
    font-size: 16px;
  }
}
@media screen and (max-width: 1200px) {
  .blind-banner .banner-box {
    transform: translate(-35%, -8%);
  }
  .blind-banner .banner-box .blind-banner-text {
    font-size: 14px;
    width:415px;
  }
}
@media screen and (max-width: 990px) {
  .blind-banner .banner-box {
    transform: translate(-45%, 0%);
  }
  .blind-banner .banner-box .blind-banner-text {
    font-size: 13px;
    width:395px;
    margin-bottom: 5px;
  }
  .blind-banner .goNonEvaluation,.goEvaluation {
    width:145px;
    height:35px;
    font-size: 16px;
  }
  .lading-box .dialog {
    width: 95%;
  }
  .options {
    justify-content: space-evenly;
  }
  .container {
    max-height: 482px;
    overflow: auto;
  }
  .question li {
    margin-bottom: 20px;
  }
  .form-commit .progress-bar-text {
    margin-bottom: 10px;
  }
  .form-commit .dialogTitle {
    margin-bottom: 15px;
  }
  #submitBtn {
    margin-top: 8px;
  }
  .question ul {
    margin-top: 10px;
  }
}
@media screen and (max-width: 820px) {
  .blind-banner .banner-box {
    transform: translate(-45%, 0%);
  }
  .blind-banner .banner-box .blind-banner-text {
    font-size: 12px;
    width:350px;
  }
}
@media screen and (max-width: 768px) {
  .blind-banner .blind-banner-small-img {
    display:block;
  }
  .blind-banner .blind-banner-img {
    display:none;
  }
  .blind-banner .banner-box {
    transform: translate(-50%, -50%);
  }
  .blind-banner .banner-box .blind-banner-text {
    font-size: 14px;
    width: 335px;
    margin-bottom: 16px;
  }
  .blind-banner .banner-box {
    position: absolute;
    left: 50%;
    bottom: 54%;
  }
  .lading-box .dialog {
    padding: 30px 30px 40px;
  }
  .option {
    width: 240px;
    height: 180px;
    margin-bottom: 15px;
  }
  .form-commit .dialogTitle {
    font-size: 22px;
  }
  .form-commit .dialog-close {
    position: absolute;
    right: 30px;
    top: 30px;
    cursor: pointer;
  }
}
@media screen and (max-width: 700px) {
  .question ul {
    justify-content: space-around;
  }
  .question li {
    &:last-child:nth-child(4n-1) {
      margin-right: 50%;
    }
  }
}
@media screen and (max-width: 600px) {
  .blind-banner .banner-box {
    position: absolute;
    left: 50%;
    bottom: 50%;
    transform: translate(-50%, -45%);
  }
  .blind-banner .banner-box .blind-banner-text {
    line-height: 22px;
  }
  .lading-box .dialog {
    padding: 25px 20px 40px;
  }
  .option {
    width: 190px;
    height: 150px;
  }
  .option div {
    line-height: 18px;
  }
}
@media screen and (max-width: 480px) {
  .blind-banner .banner-box {
    position: absolute;
    left: 50%;
    bottom: 48%;
    transform: translate(-50%, -50%);
  }
  .blind-banner .banner-box .blind-banner-text {
    line-height: 18px;
    margin-bottom: 5px;
  }
  .blind-banner .goNonEvaluation,.goEvaluation {
    width:114px;
    height:27px;
    font-size: 14px;
  }
    .option {
    width: 150px;
    height: 110px;
    margin-bottom: 10px;
  }
  .option div {
    font-size: 12px;
    line-height: 14px;
  }
  .question li img {
    padding: 6px 6px 4px;
  }
  #NextBtn {
    width: 170px;
    height: 40px;
    line-height: 40px;
    font-size: 14px;
  }
  .options {
    justify-content: space-around;
  }
  .question li {
    width: 155px;
  }
  .form-commit .dialogTitle {
    font-size: 18px;
  }
  .form-commit .progress-bar-text {
    font-size: 14px;
  }
  .blindBoxTwo-text {
    font-size: 12px;
  }
  .form-commit .dialog-close {
    position: absolute;
    right: 20px;
    top: 20px;
    cursor: pointer;
    width: 26px;
  }
}
@media screen and (max-width: 375px) {
  .blind-banner .banner-box {
    position: absolute;
    left: 50%;
    bottom: 45%;
    transform: translate(-50%, -50%);
  }
    .option {
    width: 145px;
  }
  .question li {
    width: 145px;
  }
  .options {
    justify-content: space-between;
  }
}
{%- endstyle -%}
<div class="lading-box">
  <div class="blind-banner">
    <div class="blind-banner-img"><img src="{{ section.settings.image | img_url: '1920x' }}" alt="" loading="lazy"></div>
    <div class="blind-banner-small-img"><img src="{{ section.settings.cellphoneBackground | img_url: '768x' }}" alt="" loading="lazy"></div>
    <div class="banner-box">
      <div class="blind-banner-text">{{section.settings.introduction}}</div>
      <div class="btn-box">
        <button class="goEvaluation">{{section.settings.btnTest}}</button>
        <button class="goNonEvaluation">{{section.settings.btnBuy}}</button>
      </div>
    </div>
  </div>
<div class="form-commit dialog">
  <div class="dialogTitle">{{section.settings.dialogTitle}}</div>
  <div class="dialog-close"><img src="https://cdn.shopifycdn.net/s/files/1/0356/5997/2741/files/img_v2_5f157711-4418-4552-b0c6-4507ef5cfd5g.png?v=1683708421" alt="" loading="lazy"></div>
  <div class="progress-bar">
    <div class="progress-bar-one"></div>
    <div class="progress-bar-two"></div>
  </div>
  <div class="dialog-one">
    <div class="progress-bar-progress">1/2</div>
    <div class="progress-bar-text">{{section.settings.dialogOneText}}</div>
  </div>
  <div class="dialog-two active">
    <div class="progress-bar-progress">2/2</div>
    <div class="progress-bar-text">{{section.settings.dialogTwoText}}</div>
    <div class="blindBoxTwo-text active">{{section.settings.blindBoxPromptText}}</div>
  </div>
  <div class="container">
    <div class="options">
      {%- for block in section.blocks -%}
      {%- case block.type -%}
      {%- when 'blindBoxOne' -%}
      {% assign index = forloop.index %}
      <div class="option">
        <label for="option{{index}}">
          <input type="checkbox" id="option{{index}}" name="option{{index}}" value="option{{index}}">
          {%- if block.settings.img != black -%}
          <img class="blind-box-products-img" src="{{ block.settings.img | img_url: '1920x' }}" alt="" loading="lazy">
          {%- endif -%}
          <div class="option-text{{ index }}">{{block.settings.text}}</div>
        </label>
      </div>
      {%- endcase -%}
      {%- endfor -%}
      <div class="btn-box-NextBtn"><button id="NextBtn" disabled>Next</button></div>
    </div>
    <div class="question active">
      <ul>
        {%- for block in section.blocks -%}
        {%- case block.type -%}
        {%- when 'blindBoxTwo' -%}
        {% assign indexs = forloop.index %}
        <li data-value="{{indexs}}"><img src="{{ block.settings.img | img_url: '1920x' }}" alt="" loading="lazy"><span>{{
            block.settings.text }}</span></li>
        {%- endcase -%}
        {%- endfor -%}
      </ul>
      <button id="submitBtn" disabled>submit</button>
    </div>
  </div>
</div>
</div>
  <script>
    var $box1 = $('input[name="option1"]');
    var $box2 = $('input[name="option2"]');
    var $box3 = $('input[name="option3"]');
    var $box4 = $('input[name="option4"]');
    $(function () {
      $('.option input[type="checkbox"]').on('click', function () {
        // 取消选中第四个选项
        if ($(this).attr('id') != 'option4' && $('#option4').prop('checked')) {
          $('#option4').prop('checked', false);
        }
        // 取消选中前三个选项
        if ($(this).attr('id') == 'option4' && $(this).prop('checked')) {
          $('#option1,#option2,#option3').prop('checked', false);
        }
        // 取消选中第四个选项
        if ($('#option1').prop('checked') || $('#option2').prop('checked') || $('#option2').prop('checked')) {
          $('#option4').prop('checked', false);
        }
        // 判断是否选中选项
        var isChecked = false;
        $('.option input[type="checkbox"]').each(function () {
          if ($(this).prop('checked')) {
            isChecked = true;
            return false;
          }
        });
        // 设置提交按钮状态及选项边框颜色
        if (isChecked) {
          $('#NextBtn').prop('disabled', false);
          $('#NextBtn').css('background', '#33B77B')
          $('.option input[type="checkbox"]').each(function () {
            if ($(this).prop('checked')) {
              $(this).parents('.option').addClass('highlight');
            } else {
              $(this).parents('.option').removeClass('highlight');
            }
          });
        } else {
          $('#NextBtn').prop('disabled', true);
          // $('#NextBtn').css('background', 'gray')
          $('.option').removeClass('highlight');
        }
      });
      var selected = {};
      //下一题按钮点击事件
      $('#NextBtn').on('click', function () {
          $.ajax({
            type: 'get',
            dataType: 'json',
            url: "https://qn.htvront.com/htvront-blindBox/click?site=US&module=盲盒测评弹窗&clickName=Next",
            data: selected,
            success: function (result) {
              console.log(result);
            },
            error: function (err) {
              console.log(err);
            }
          });
        $('.option').removeClass('highlight');
        if ($box1.is(':checked')) {
          selected['cut'] = ($('.option-text1').text());
        }
        if ($box2.is(':checked')) {
          selected['hotPress'] = ($('.option-text2').text());
        }
        if ($box3.is(':checked')) {
          selected['printer'] = ($('.option-text3').text());
        }
        if ($box4.is(':checked')) {
          selected[$('.option-text4').text()] = ($('.option-text4').text());
        }
        $('.option input[type="checkbox"]').each(function () {
          $(this).prop('checked', false)
        });
        $('.question').removeClass('active').siblings('.options').addClass('active');
        $('.progress-bar-two').css('background','#3BC888')
        $('.dialog-one').addClass('active').siblings('.dialog-two').removeClass('active');
        $('#NextBtn').prop('disabled', true);
        // $('#NextBtn').css('background', 'gray')
      });
      var limit = 3; // 最多选择 3 个选项
      var selectedCount = 0; // 已选择选项的数量

      // 点击选项
      $('.question li').on('click', function () {
        var $this = $(this);

        // 判断是否为禁用选项
        if ($this.hasClass('disabled')) {
          return;
        }

        // 判断是否为选择或取消选择
        if ($this.hasClass('highlight')) {
          $this.removeClass('highlight');
          selectedCount--;
        } else {
          if (selectedCount < limit) {
            $this.addClass('highlight');
            selectedCount++;
          } else {
            alert('最多只能选择 ' + limit + ' 个选项。');
          }
        }
        if (selectedCount >= 1) {
          $('#submitBtn').prop('disabled', false);
        } else {
          $('#submitBtn').prop('disabled', true);
        }
      });
      //打开测评按钮 
      $('.btn-box .goEvaluation').on('click',function () {
          $.ajax({
            type: 'get',
            dataType: 'json',
            url: "https://qn.htvront.com/htvront-blindBox/click?site=US&module=盲盒落地页&clickName=Test",
            data: selected,
            success: function (result) {
              console.log(result);
            },
            error: function (err) {
              console.log(err);
            }
          });
      })
      //打开非测评按钮 
      $('.btn-box .goNonEvaluation').on('click',function () {
          $.ajax({
            type: 'get',
            dataType: 'json',
            url: "https://qn.htvront.com/htvront-blindBox/click?site=US&module=盲盒落地页&clickName=Buy",
            success: function (result) {
              console.log(result);
              window.location.href = "https://www.htvront.com/pages/blind-box-no-form";
            },
            error: function (err) {
              console.log(err);
            }
          });
      })
      // 点击提交按钮
      $('#submitBtn').on('click', function () {
        // 遍历已选择的选项，将其转化为对象
        $('.question li.highlight').each(function () {
          if ($(this).text().trim() == "Bags") {
            selected['bag'] = true;
          }
        });
        $.ajax({
          type: 'get',
          dataType: 'json',
          // url: "https://qn.htvront.com/htvront-blindBox/click?site=DE&module=运营资源位&clickName=test",
          url: "https://qn.htvront.com/htvront-blindBox/result",
          data: selected,
          success: function (result) {
            switch (result.msg) {
              case 'A1':
                window.location.href = "https://www.htvront.com/pages/blind-box-result";
                break;
              case 'A2':
                window.location.href = "https://www.htvront.com/pages/blind-box-result1";
                break;
              case 'B1':
                window.location.href = "https://www.htvront.com/pages/blind-box-result2";
                break;
              case 'B2':
                window.location.href = "https://www.htvront.com/pages/blind-box-result3";
                break;
              case 'C1':
                window.location.href = "https://www.htvront.com/pages/blind-box-result4";
                break;
              case 'C2':
                window.location.href = "https://www.htvront.com/pages/blind-box-result5";
                break;
              case 'C3':
                window.location.href = "https://www.htvront.com/pages/blind-box-result6";
                break;
              case 'D1':
                window.location.href = "https://www.htvront.com/pages/blind-box-result7";
                break;
              case 'D2':
                window.location.href = "https://www.htvront.com/pages/blind-box-result8";
                break;
              case 'D3':
                window.location.href = "https://www.htvront.com/pages/blind-box-result9";
                break;
              case null:
                window.location.href = "https://www.htvront.com/pages/blind-box-no-form";
                break;
            }
          },
          error: function (err) {
            console.log(err);
          }
        });
        // 取消选择样式并将选项还原到未选中状态
        $('li').removeClass('highlight').removeClass('disabled');
        selectedCount = 0;
        $('.dialog').css('display','none')
        $('.progress-bar-two').css('background','#96D8BA')
        $('.dialog-one').removeClass('active').siblings('.dialog-two').addClass('active');
        $('.options').removeClass('active').siblings('.question').addClass('active');
        selected= {}
        $('#submitBtn').prop('disabled', true);
          $('.blindBoxTwo-text').addClass('active')
          $.ajax({
            type: 'get',
            dataType: 'json',
            url: "https://qn.htvront.com/htvront-blindBox/click?site=US&module=盲盒测评弹窗&clickName=submit",
            data: selected,
            success: function (result) {
              console.log(result);
            },
            error: function (err) {
              console.log(err);
            }
          });
      });
      $('.form-commit .dialog-close').on('click', function () {
        $('.dialog').css('display','none')
        $('li').removeClass('highlight').removeClass('disabled');
        selectedCount = 0;
        $('.dialog').css('display','none')
        $('.progress-bar-two').css('background','#96D8BA')
        $('.dialog-one').removeClass('active').siblings('.dialog-two').addClass('active');
        $('.options').removeClass('active').siblings('.question').addClass('active');
        $('.dialog-two .blindBoxTwo-text').addClass('active');
        selected= {}
        $('#submitBtn').prop('disabled', true);
      })

      // 当选择了 3 个选项时，禁用未选择选项
      $('li').on('click', function () {
        if (selectedCount >= limit) {
          // $('li').not('.selected').addClass('disabled');
          // $('li').addClass('disabled');
          $('.blindBoxTwo-text').removeClass('active')
        } else {
          // $('li').removeClass('disabled');
          $('.blindBoxTwo-text').addClass('active')
        }
      });
      $('.blind-banner .goEvaluation').on('click', function () {
          $('.dialog').css('display','block')
      })
    });
  </script>
{% schema %}
  {
    "name": "Blind Box Banner",
    "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "banner"
    },
    {
      "type": "image_picker",
      "id": "cellphoneBackground",
      "label": "cellphoneBackground"
    },
    {
      "type": "text",
      "id": "introduction",
      "label": "introduction"
    },
    {
      "type": "text",
      "id": "btnTest",
      "label": "btnTest"
    },
    {
      "type": "text",
      "id": "btnBuy",
      "label": "btnBuy"
    },
    {
      "type": "color",
      "id": "btnTextColor",
      "label": "btnTextColor"
    },
    {
      "type": "color",
      "id": "btnBagColor",
      "label": "btnBagColor"
    },
    {
      "type": "text",
      "id": "dialogTitle",
      "label": "dialogTitle"
    },
    {
      "type": "text",
      "id": "dialogOneText",
      "label": "dialogOneText"
    },
    {
      "type": "text",
      "id": "dialogTwoText",
      "label": "dialogTwoText"
    },
    {
      "type": "text",
      "id": "blindBoxPromptText",
      "label": "blindBoxPromptText"
    }
    ],
    "blocks": [
    {
      "type": "blindBoxOne",
      "name": "blindBoxOne",
      "settings": [
        {
          "type": "image_picker",
          "id": "img",
          "label": "img"
        },
        {
          "type": "text",
          "id": "text",
          "label": "text"
        }
      ]
    },
    {
    "type": "blindBoxTwo",
    "name": "blindBoxTwo",
    "settings": [
      {
        "type": "image_picker",
        "id": "img",
        "label": "img"
      },
      {
        "type": "text",
        "id": "text",
        "label": "text"
      }
    ]
  }
    ],
  "presets": [
    {
      "name": "Blind Box Banner"
    }
  ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}