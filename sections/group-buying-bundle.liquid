<style>
  .group-buying-bundle{
     background-image:url('{{ section.settings.bg_image | img_url:'1920x' }}');
    background-size:100% 100%;
    background-repeat:no-repeat;
    letter-spacing: 0;
    padding: 10px 0 30px 0;
  }
  .bundle-width {
    width: 1600px;
    margin: 0 auto;
    display:flex;
    align-items: flex-start;
  }
  .bundle-imgbox{
    padding:20px 30px 20px 20px;
    background: linear-gradient(180deg, #FFF8EE 1%, #FFEFDA 100%);
    border-radius: 10px;
    display:flex;
    max-width: 1027px;
  }
  .bundle-image{
    margin-right: 17px;
    position:relative;
    min-width:400px;
  }
  .bundle-image a{
    position:relative;
  }
  .bundle-image p{
    position: absolute;
    width: 100%;
    height: 46px;
    background: linear-gradient(180deg, #FFEFB3 0%, #F9CC55 100%);
    border-radius: 0px 0px 8px 8px;
    color: #C87804;
    font-size: 18px;
    text-align: center;
    line-height: 46px;
    bottom: 0;
    font-weight: bold;
  }
  .bundle-image img{
    border-radius:8px;
  }
  .bundle-imgbox .button--full-width{
    width: 300px;
    height: 60px;
    background: linear-gradient(156deg, #FFCD66 0%, #ECA62F 100%);
    border-radius: 10px;
    --border-offset: none;
    --border-opacity: none;
    padding: 0;
  }
  .bundle-imgbox .button--full-width .t{
    font-size: 20px;
    font-weight: 600;
  }
  .bundle-text h3{
    font-size: 28px;
    font-weight: bold;
    color: #914408;
    line-height: 38px;
    letter-spacing: -0.5px;
    padding-top: 7px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
  }
  .bundle-desc{
    font-size: 24px;
    color: #914408;
    line-height: 33px;
    letter-spacing: -0.5px;
    padding: 15px 0 10px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
    height: 55px;
  }
  .bundle_price{
    display:flex;
    align-items: end;
  }
  .bundle_price>b{
    font-size:24px;
    color: #914408;
  }
  .bundle_price .price{
    padding-left:10px;
  }
  .bundle-text .fn-compareat_price{
    flex-direction: row;
    align-items: baseline;
  }
  .bundle_price .fn-compareat_price span:nth-child(1){
    font-size: 30px;
    font-weight: bold;
    color: #FF7606;
  }
  .bundle_price .fn-compareat_price .fn-compare-at_price{
    font-size: 24px;
    color: #914408;
    padding-left: 8px;
  }
  .bundle-text{
    position:relative;
  }
  .bundle-addcart{
    position: absolute;
    bottom: 0;
  }
  .bundle-progress{
    display:flex;
    align-items: baseline;
    margin-bottom:20px;
  }
  .fn-discounts-productssold{
    font-size: 24px;
    color: #914408;
    padding-right: 13px;
  }
  .fn-discounts-progressbarone {
    width: 100%; 
    border: 1px solid #FFAB3D;
  }
  .fn-discounts-progressbartwo, .fn-discounts-progressbarone {
    height: 14px;
    border-radius: 12px;
  }
  .fn-discounts-progressbartwo {
    max-width: 100%;
    position: absolute;
    background: linear-gradient(90deg, #FF8219 0%, #FFC264 100%);
    top: 0;
  }
  .fn-discounts-progressbar {
    position: relative;
    width:68%;
  }
  .tags-box{
    display: inline-block;
    padding: 5px 28px;
    border-radius: 25px;
    font-size: 18px;
    margin: 10px 10px 0 0 ;
  }
  .tags-box:nth-of-type(1){
    margin-right:0;
  }
  .bundle-tags{
    min-height:95px;
  }
  .group-rules{
    padding: 10px 0 0 30px;
    color: #914408;
  }
  .rules-text>p{
    font-size:20px;
    font-weight: bold;
  }
  .rules-text>ul{
    font-size:18px;
    max-width: 520px;
  }
  .rules-text>ul>li{
    line-height:28px;
    padding-left: 15px;
  }
  .rules-text>ul>li:before{
    content:'';
    width: 6px;
    height: 6px;
    display:inline-block;
    background: #914408;
    border-radius:50%; 
    margin-right: 10px;
    margin-bottom: 3px;
    margin-left: -15px;
  }
  .bundle_price .price__regular .price-item--regular{
    font-size: 30px;
    font-weight: bold;
    color: #FF7606;
    line-height: 40px;
  }
  @media screen and (max-width: 1720px){
    .bundle-width{
      width: 83.3%;
    }
    .fn-discounts-productssold{
      font-size:16px;
    }
  }
  @media screen and (max-width: 1440px){
    .bundle-text h3{
      line-height: 30px;
      padding-top: 0;
      font-size: 22px;
      padding: 5px 0;
      height: 40px;
    }
    .bundle-desc {
      font-size: 18px;
      padding: 5px 0;
      height: 40px;
    }
    .tags-box {
      padding: 5px 14px;
      font-size: 14px;
      margin: 10px 5px 0 0;
    }
    .fn-discounts-productssold {
      font-size: 14px;
      padding-right: 5px;
      width: 40%;
    }
    .bundle_price>b,.bundle_price .fn-compareat_price .fn-compare-at_price {
      font-size: 16px;
    }
    .bundle_price .fn-compareat_price span:nth-child(1) {
      font-size: 18px;
    }
    .bundle-imgbox .button--full-width {
      width: 150px;
      height: 40px;
    }
    .bundle-imgbox .button--full-width .t {
      font-size: 16px;
    }
     .bundle-image{
       min-width:auto
     }
     .bundle-image p{
        font-size: 14px;
        line-height: 25px;
        height: 25px;
     }
  }
   @media screen and (max-width: 1280px){
     .bundle_price {
        flex-direction: column;
        align-items: start;
      }
     .bundle_price .price{
       padding-left:0;
     }
     .bundle-progress{
        flex-direction: column;
     }
     .fn-discounts-productssold,.fn-discounts-progressbar{
       width:100%;
     }
     .bundle-addcart {
      position: relative;
     }
   }
  @media screen and (max-width:820px){
    .bundle-width{
      width: 93.6%;
      flex-direction: column;
      align-items: normal;
    }
    .rules-text>p {
      font-size: 14px;
      line-height: 19px;
    }
    .rules-text>ul>li {
      line-height: 20px;
      padding-left: 15px;
      font-size: 14px;
    }
    .rules-image img{
      margin:0 auto;
    }
    .bundle-imgbox{
      flex-direction: column;
      padding: 18px 18px 10px;
      max-width: 100%;
    }
    .bundle-image img {
      margin: 0 auto;
    }
    .bundle-image p{
      height:42px;
      line-height:42px;
      font-size:14px;
    }
    .bundle-text h3{
      font-size:14px;
      height: 30px;
      line-height: 23px;
    }
    .bundle-desc {
      font-size: 14px;
      height: 30px;
      line-height: 22px;
    }
    .tags-box {
      padding: 6px 16px;
      font-size: 12px;
      margin: 8px 8px 0 0;
    }
    .bundle-tags {
      min-height: auto;
    }
    .fn-discounts-progressbartwo, .fn-discounts-progressbarone {
      height: 8px;
    }
    .bundle-progress {
      flex-direction: row;
      margin: 10px 0;
    }
    .fn-discounts-productssold {
      width: 136px;
    }
    .fn-discounts-progressbar{
      width:100%;
    }
    .bundle-addcart {
      position: inherit;
    }
    .bundle_price {
      flex-direction: row;
      align-items: end;
      margin-bottom: 10px;
    }
    .bundle_price>b, .bundle_price .fn-compareat_price .fn-compare-at_price {
      font-size: 14px;
    }
    .bundle_price .fn-compareat_price span:nth-child(1) {
      font-size: 20px;
    }
    .bundle-imgbox .button--full-width .t {
      font-size: 14px;
    }
    .bundle-imgbox .button--full-width {
      border-radius:6px;
      width: 100%;
    }
    .group-rules {
      padding: 10px 0 0 0;
    }
    .bundle-image {
      margin: 0 auto;
    }
  }
  @media screen and (max-width: 750px){
   .group-buying-bundle{
     background:{{ section.settings.bg_color }};
     padding-bottom:0;
   }
    .bundle-text .fn-compareat_price{
      padding-left:5px;
    }
  }
</style>

<div class="group-buying-bundle">
  <div class="bundle-width">
    <div class="bundle-imgbox">
      <div class="bundle-image">
         <a href="{{ section.settings.product_item.url }}">
          {% if section.settings.bundle_image != blank %}
            <img src="{{ section.settings.bundle_image | img_url: '400x' }}" alt="" >
          {% endif %}
         {% if section.settings.img_tips %}
           <p>{{ section.settings.img_tips }}</p>
         {% endif %}
         </a>
      </div>
      <div class="bundle-text">
         <a href="{{ section.settings.product_item.url }}">
            <h3>{{ section.settings.bundle_title }}</h3>
         </a>
        <div class="bundle-desc">{{ section.settings.bundle_desc }}</div>
        <div class="bundle-tags">
           {% for block in section.blocks %}
              <div class="tags-box" style="background-color:{{ block.settings.tags_color }};color:{{ block.settings.tags_text_color }}">
                {{ block.settings.tags_text }}
              </div>
          {% endfor %}
        </div>
        <div class="bundle-progress">
           <div class="fn-discounts-productssold">
            <span class="fn-discounts-inventoryright number" id="lowprice_schedule" total_sum="{{ section.settings.product_total }}" lowprice_id="fn-lowprice_id">
                {{ section.settings.sold_out_quantity }}
            </span>
            units sold
          </div>
          <div class="fn-discounts-progressbar">
            <div class="fn-discounts-progressbarone"></div>
            <div class="fn-discounts-progressbartwo" id="fn-lowprice_id"></div>
          </div>
        </div>
        <div class="bundle_price">
          <b>Group Price:</b>
          {% render 'sffers-price', product: section.settings.product_item, price_class: '' %}
        </div>
        {% if section.settings.button == "true" %}
          <div class="bundle-addcart">
            {% render 'addCart-Model' ,product: section.settings.product_item, buttonText: section.settings.button_text %}
          </div>
        {% endif %}
      </div>
    </div>
    <div class="group-rules">
      <div class="rules-text">{{ section.settings.rules_text }}</div>
      <div class="rules-image">
        <img src="{{ section.settings.rules_image | img_url:'430x' }}"/> 
      </div>
    </div>
  </div>
</div>
 <!-- 只用来获取时间,所以隐藏 -->
 <div class="group_start_time" style="display:none">{{ section.settings.time }}</div>
   
       
<script>
  $(function (){
    //进度条展示 
      var lowpriceWidth = document.body.clientWidth;
      // 总的目标值remaining_schedule_s
      $('.fn-discounts-inventoryright').each(function(i, item){
          var total = $(item).attr('total_sum')
          var id = '#'+$(item).attr('id')
          var lowprice = '#'+$(item).attr('lowprice_id')
          var lowprice_schedule_s  = total;
          // 实际数值
          var sum_schedule = $(id).text();
          let lowprice_schedule=0
          sum_schedule.split(',').map(item=>{
            lowprice_schedule += parseFloat(item)?parseFloat(item):0
          })
          $(id).text(lowprice_schedule)
          var a =(lowprice_schedule/lowprice_schedule_s)*100
          $(lowprice).css("width",a+'%');
      })
  })
  $(function (){
      /**
     * 计算两个时间差
     */
    var delta = 0;
    function timePoor() {
      var times = $('.group_start_time').text();
      //开始时间
      var startTime = times;
      //现在时间
      var newTime = new Date();
      var date3 = new Date(newTime).getTime() - new Date(startTime).getTime(); //时间差的毫秒数        
      delta = Math.floor(date3 / (1000 * 60 * 60 * 3))
      // console.log(Math.floor(date3 / (1000 * 60 * 60 * 3)),'时间差除以秒数')
    }
    timePoor();
    let timelyVal;
    let relaVal = localStorage.getItem("real_time");
    let og_num = Number($('.number').text())
    if(relaVal){
       $('.number').text(relaVal)
    }
    // console.log(relaVal,'文本框目前展示的值')
    let num = Number(relaVal)
    let oldNum =  localStorage.getItem("group_buy");
    if(oldNum == null){
     localStorage.setItem("group_buy",num);
    }else if(num != Number(oldNum)){
     localStorage.setItem("group_buy",num);
    }
    var real_num = delta + og_num
    $('.number').text(real_num)
      // console.log(num,'相加后的次数',oldNum,'存的值')
      // console.log(delta,'除出来的次数',og_num,'文本框该显示的值')
      setInterval(updateNum, 1000 * 60 * 60 * 3);
      updateNum();
     function updateNum(){
      if(real_num != num){
        $('.number').text(real_num++)
      }else{
        $('.number').text(num++)
      }
      timelyVal = $('.number').text()
      localStorage.setItem("real_time",timelyVal);
    }
  })
</script>
{% schema %}
  {
    "name": "Group Buying Bundle",
    "settings": [ 
      {
        "type":"color",
        "id":"bg_color",
        "label":"background color"
      },
      {
        "type":"image_picker",
        "id":"bg_image",
        "label":"background image"
      },
      {
        "type":"text",
        "id":"time",
        "label":"开始时间（必填）"
      },{
        "type":"text",
        "id":"product_total",
        "label":"product total(总数)"
      },{
        "type":"number",
        "id":"sold_out_quantity",
        "label":"sold out quantity(已抢)"
      },{
        "type": "product",
        "id": "product_item",
        "label": "product item"
      },{
        "type":"image_picker",
        "id":"bundle_image",
        "label":"bundle image"
      },
      {
        "type":"text",
        "id":"img_tips",
        "label":"image tips"
      },{
        "type":"text",
        "id":"bundle_title",
        "label":"bundle title"
      },{
        "type":"text",
        "id":"bundle_desc",
        "label":"bundle desc"
      },
      {
         "type":"radio",
         "id":"button",
         "label":"button(show/hide) ",
         "default": "true",
           "options": [
            {
              "value": "true",
              "label": "show"
            },
            {
              "value": "false",
              "label": "hide"
            }
          ]
        },{
        "type":"text",
        "id":"button_text",
        "label":"button text"
      },{
        "type":"html",
        "id":"rules_text",
        "label":"rules text"
      },{
        "type":"image_picker",
        "id":"rules_image",
        "label":"rules image"
      }
    ],
     "blocks":[{
        "name":"tags",
        "type":"tags",
        "settings":[{
          "type":"text",
          "id":"tags_text",
          "label":"tags text"
        },{
          "type":"color",
          "id":"tags_color",
          "label":"tags background color"
        },{
          "type":"color",
          "id":"tags_text_color",
          "label":"tags text color"
        }]
     }],
    "presets":[
        {
          "name":"Group-Buying-Bundle"
        }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}