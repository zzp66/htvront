<style>
  .rate-container,.gradual {
    display: flex;
    justify-content: center;
  }
  .rate {
    position: relative;
    -webkit-appearance: none;
    border: none;
    outline: none;
    cursor: pointer;
    width: 70px;
    height: 16px;
    background: #E6E6E6;
    margin: 0;
    margin-right: 5px;
  }
  .low-active{
    background: #FFB132;
  }
  .high-active{
    background: #FF6827;
  }
  .fn-questionnaire{
    color: #333333;
    width:800px;
    background-color:#fff;
    border-radius: 10px;
    transform: translate(-50%, -50%);
    top: 50%;
    left: 50%;
    position: fixed;
    z-index: 1000;
    display:none;
   }
  .fn-questionnaire .title{
    font-size: 22px;
    font-weight: bold;
    color: #EC7D32;
    line-height: 26px;
    margin: 0;
    text-align: center;
    padding: 20px 0 30px;
  }
  .fn-questionnaire .desc{
    font-size: 16px;
    font-weight: 400;
    line-height: 19px;
  }
  .rate-title{
    font-size: 18px;
    font-weight: bold;
    line-height: 21px;
  }
  .services-qusetion p{
    font-size: 16px;
    line-height: 19px;
    padding: 8px 0;
    position: relative;
    padding-left: 15px;
  }
  .services-qusetion p:before{
    content:'';
    width: 5px;
    height: 5px;
    border-radius: 50%;
    position: absolute;
    left: 0;
    background: #000;
    top: 50%;
    transform: translatey(-50%);
  }
  .rate-tips{
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    line-height: 16px;
    margin-top: 10px;
  }
  .fn-mask{
    position: fixed;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    left: 0;
    top: 0;
    z-index: 999;
    display:none;
  }
  .icon-close{
    width: 26px;
    position: absolute;
    right: 20px;
    top: 20px;
    cursor: pointer;
  }
  .rate-services,.rate-select{
    margin-top:25px;
  }
  .rate-select{
    display:none;
  }
  .rate-button,.rate-load{
    width: 200px;
    height: 56px;
    background: linear-gradient(96deg, #FFA264 0%, #FF822E 100%);
    border-radius: 10px;
    margin: 0 auto;
    text-align: center;
    cursor: pointer;
  }
  .rate-load .spinner{
    height: 35px;
    margin-top: 10px;
  }
  .rate-button>span{
    line-height: 56px;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
  }
  .rate-footer{
    margin: 20px 0 25px;
  }
  .rate-footer .error{
    font-size: 16px;
    font-weight: 400;
    color: #FF0000;
    line-height: 19px;
    text-align: center;
    margin-top: 10px;
    display:none;
  }
  .rate-footer .error span{
    display: inline-block;
    border: 2px solid #ff0000;
    border-radius: 50%;
    padding: 0px 7px;
    margin-right: 5px;
    vertical-align: baseline;
  }
  .rate-footer .success{
    font-size: 16px;
    color: #FF7B01;
    line-height: 19px;
    text-align: center;
    margin-top: 10px;
    display:none;
  }
  .rate-footer .success span{ 
    display: inline-block;
    border-radius: 50%;
    padding: 2px 5px;
    margin-right: 5px;
    vertical-align: baseline;
    background-color: #ff7b01;
    color: #fff;
  }
  .services-qusetion{
    display: flex;
    flex-direction: column;
  }
  .fn-questionnaire .scroll{
    max-height: 660px;
    overflow-y: auto;
    padding:5px 28px;
  }
  .select-qusetion>div>p{
    font-size: 16px;
    font-weight: bold;
    line-height: 19px;
    margin-bottom: 10px;
  }
  .select-qusetion>div{
    margin-top:20px;
    display:none;
  }
  .select-qusetion>div:nth-child(1){
    margin-top:10px;
  }
  .select-qusetion>div input[type=text]{
    height: 40px;
    border-radius: 4px;
    border: 1px solid #979797;
    width: 100%;
    outline: none;
    padding: 0 15px;
    font-size: 14px;
    margin-top: 5px;
    display:none;
  }
  .recommend{
    margin-top:15px;
  }
  .recommend .rate-title{
    margin-bottom:12px;
  }
  .checkbox-group>div>label{
    font-size: 16px;
    line-height: 19px;
  }
  .checkbox-group>div{
    margin:3px 0;
  }
 .select-qusetion>div input[type=checkbox]{
    width: 8px;
    height: 8px;
    position: relative;
 }
  .select-qusetion>div input[type='checkbox']:checked:before {
    position: absolute;
    width: 16px;
    height: 16px;
    content: '✔';
    color: #FF6827;
    top: -8px;
    z-index: 2;
  }
  .select-qusetion>div  input[type='checkbox']:checked:after {
    content: '';
    width: 8px;
    height: 8px;
    background-color: #fff;
    border: 1px solid #333;
    display: inline-block;
    position: absolute;
    top: 0;
  }
 .rate1.active1{
   background: #FFB132;
  }
  .rate2.active1{
    background: #FFB132;
  }
  .rate3.active1{
   background: #FFB132;
  }
  .rate4.active1{
    background: #FFB132;
  }
  .rate5.active1{
    background: #FFB132;
  }
  .rate6.active1{
    background: #FF6827;
  }
  .rate7.active1{
    background: #FF6827;
  }
  .rate8.active1{
   background: #FF6827;
  }
  .rate9.active1{
    background: #FF6827;
  }
  .rate10.active1{
    background: #FF6827;
  }
  
  .rate1.active{
    background: linear-gradient(90deg, #FFFAF1 0%, #FFF5E2 100%);
  }
  .rate2.active{
    background: linear-gradient(270deg, #FFECC2 0%, #FFF6E3 100%);
  }
  .rate3.active{
    background: linear-gradient(270deg, #FFE4A7 0%, #FFECC2 100%);
  }
  .rate4.active{
    background: linear-gradient(270deg, #FFD169 0%, #FFE4A7 100%);
  }
  .rate5.active{
    background: linear-gradient(270deg, #FFC43F 0%, #FFD169 100%);
  }
  .rate6.active{
    background: linear-gradient(270deg, #FFB100 0%, #FFC43F 100%);
  }
  .rate7.active{
    background: linear-gradient(90deg, #FFB100 0%, #FB8F2B 100%);
  }
  .rate8.active{
    background: linear-gradient(270deg, #FF7120 0%, #FC902B 100%);
  }
  .rate9.active{
    background: linear-gradient(90deg, #FF7120 0%, #FF3D00 100%);
  }
  .rate10.active{
    background: linear-gradient(90deg, #FF3D00 0%, #D31900 100%);
  }
  
   @media screen and (max-width: 1660px){
    .fn-questionnaire{
      height:95%;
    }
    .fn-questionnaire .title{
      padding: 20px 0;
    }
    .rate-services, .rate-select {
      margin-top: 15px;
    }
    .rate-button,.rate-load{
      width: 160px;
      height: 45px;
      line-height: 45px;
      border-radius:6px;
    }
    .rate-button>span{
      line-height: 45px;
    }
    .rate-footer {
      margin: 20px 0;
    }
    .fn-questionnaire .scroll{
      height: calc(100% - 184px);
    }
    .rate-load .spinner{
      height: 30px;
      margin-top: 6px;
    }
  }
   @media screen and (max-width: 820px){
    .fn-questionnaire{
      width:80%
    }
   }
   @media screen and (max-width: 750px){
     .fn-questionnaire .title{
       font-size: 16px;
     }
     .icon-close{
        width: 19px;
        top: 10px;
     }
     .fn-questionnaire .desc,.select-qusetion>div>p,.checkbox-group>div>label,.rate-footer .error,.rate-footer .success {
      font-size: 14px;
      line-height: 16px;
     }
     .rate-title {
      font-size: 16px;
      line-height: 19px;
     }
     .services-qusetion p{
      font-size: 16px;
      line-height: 19px;
     }
     .select-qusetion>div{
      margin-top:10px; 
     }
     .select-qusetion>div>p{
       margin-bottom:4px;
     }
   }
   @media screen and (max-width: 450px){
     .fn-questionnaire .scroll{
       height: calc(100% - 180px);
        padding: 0 10px;
     }
     .rate{
       height:40px;
     }
     .fn-questionnaire{
       width:95%;
     }
   }
  .question-btn{
    width: 153px;
    height: 46px;
    background: linear-gradient(180deg, #FFE4B7 0%, #FFA841 100%);
    box-shadow: inset 0px 4px 4px 0px rgba(202,121,0,0.31);
    border-radius: 27px;
    border: 2px solid #FFFCE4;
    display:flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    right: 0;
    bottom:50px;
    z-index: 10;
    cursor: pointer;
  }
 .question-btn>span{
    font-size: 16px;
    color: #E36A00;
    font-weight: bold;
    margin-left: 3px;
  }
  @media screen and (max-width: 750px){
    .question-btn{
      bottom:65px;
    }
  }
   @media screen and (max-width: 450px){
     .question-btn{
        width: 59px;
        height: 46px;
     }
     .question-btn>span{
       display:none;
     }
   }
</style>
{% if section.settings.question_set == 'true'%}
<div class="question-btn">
  <img src="https://cdn.shopifycdn.net/s/files/1/0356/5997/2741/files/Group_137.png?v=1702015647" >
  <span>FEEDBACK</span>
</div>
{% endif %}
<div class="fn-questionnaire">
  <div class="title">
    {{ section.settings.title }}
  </div>
  <img src="https://cdn.shopify.com/s/files/1/0356/5997/2741/files/icon-cup-close.png?v=1688954093" class="icon-close">
  <div class="scroll">
     <div class="desc">
      {{ section.settings.desc }}
    </div>
    <div class="recommend">
      <div class="rate-title">
        Would you recommend HTVRONT to others?(1-10)
      </div>
      <div class="services-qusetion">
        <div>
          <input type="hidden" name="recommend" value="-1">
          <div class="gradual">
            <span class="rate rate1"></span>
            <span class="rate rate2"></span>
            <span class="rate rate3"></span>
            <span class="rate rate4"></span>
            <span class="rate rate5"></span>
            <span class="rate rate6"></span>
            <span class="rate rate7"></span>
            <span class="rate rate8"></span>
            <span class="rate rate9"></span>
            <span class="rate rate10"></span>
          </div>
          <div class="rate-tips">
            <span>Very Unwilling</span>
            <span>Very Willing</span>
          </div>
        </div>  
      </div>
    </div>
    <div class="rate-services">
      <div class="rate-title">
        Please rate the HTVRONT services. (1: very dissatisfied, 10: very satisfied)
      </div>
      <div class="services-qusetion" id="services-qusetion">
        <div>
          <input type="hidden" name="interaction" value="-1">
           <p>Website interaction (e.g., shopping page, promotion, order, payment process)</p>
          <div class="gradual rate-container">
            <span class="rate rate1"></span>
            <span class="rate rate2"></span>
            <span class="rate rate3"></span>
            <span class="rate rate4"></span>
            <span class="rate rate5"></span>
            <span class="rate rate6"></span>
            <span class="rate rate7"></span>
            <span class="rate rate8"></span>
            <span class="rate rate9"></span>
            <span class="rate rate10"></span>
          </div>
          <div class="rate-tips">
            <span>1</span>
            <span>10</span>
          </div>
        </div>  
        <div>
          <input type="hidden" name="product" value="-1">
           <p>Product (e.g., product quality, style)</p>
          <div class="gradual rate-container">
            <span class="rate rate1"></span>
            <span class="rate rate2"></span>
            <span class="rate rate3"></span>
            <span class="rate rate4"></span>
            <span class="rate rate5"></span>
            <span class="rate rate6"></span>
            <span class="rate rate7"></span>
            <span class="rate rate8"></span>
            <span class="rate rate9"></span>
            <span class="rate rate10"></span>
          </div>
          <div class="rate-tips">
            <span>1</span>
            <span>10</span>
          </div>
        </div>
        <div>
          <input type="hidden" name="logistics" value="-1">
           <p>Logistics (e.g., shipping, delivery)</p>
          <div class="gradual rate-container">
            <span class="rate rate1"></span>
            <span class="rate rate2"></span>
            <span class="rate rate3"></span>
            <span class="rate rate4"></span>
            <span class="rate rate5"></span>
            <span class="rate rate6"></span>
            <span class="rate rate7"></span>
            <span class="rate rate8"></span>
            <span class="rate rate9"></span>
            <span class="rate rate10"></span>
          </div>
          <div class="rate-tips">
            <span>1</span>
            <span>10</span>
          </div>
        </div>
        <div>
          <input type="hidden" name="service" value="-1">
           <p>Customer Service (e.g., response speed, professionalism)</p>
          <div class="gradual rate-container">
            <span class="rate rate1"></span>
            <span class="rate rate2"></span>
            <span class="rate rate3"></span>
            <span class="rate rate4"></span>
            <span class="rate rate5"></span>
            <span class="rate rate6"></span>
            <span class="rate rate7"></span>
            <span class="rate rate8"></span>
            <span class="rate rate9"></span>
            <span class="rate rate10"></span>
          </div>
          <div class="rate-tips">
            <span>1</span>
            <span>10</span>
          </div>
        </div>
      </div>
    </div>
    <!-- 多选框部分 -->
    <div class="rate-select">
      <div class="rate-title">
        Which section do you think HTVRONT needs to improve?(Multiple Choice)
      </div>
      <div class="select-qusetion">
        <div class="interaction">
          <p>[Website - Shopping Page]</p>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-A" value="Poor visual design">
              <label for="checkbox1-A">Poor visual design</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-B" value="Slow page loading speed">
              <label for="checkbox1-B">Slow page loading speed</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-C" value="Complicated registration/login process">
              <label for="checkbox1-C">Complicated registration/login process</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-D" value="Difficulty finding desired products">
              <label for="checkbox1-D">Difficulty finding desired products</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-E" value="Recommended products not meeting my needs">
              <label for="checkbox1-E">Recommended products not meeting my needs</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox1" id="checkbox1-F" value="Search results not meeting my needs">
              <label for="checkbox1-F">Search results not meeting my needs</label>
            </div>
            <div class="others">
              <input type="checkbox" name="checkbox1" id="checkbox1-others">
              <label for="checkbox1-others">Others</label>
            </div>
          </div>
          <input type="text" value="" class="others-text" id="checkbox1-others-text">
        </div> 
        <div class="interaction">
          <p>[Website - Promotion]</p>
           <div class="checkbox-group">
             <div>
                <input type="checkbox" name="checkbox2" id="checkbox2-A" value="Hard-to-understand promotion rules">
                <label for="checkbox2-A">Hard-to-understand promotion rules</label>
             </div>
             <div>
                <input type="checkbox" name="checkbox2" id="checkbox2-B" value="Low promotion intensity">
                <label for="checkbox2-B">Low promotion intensity</label>
             </div>
             <div>
                <input type="checkbox" name="checkbox2" id="checkbox2-C" value="Repeatedly receiving unwanted promotion information">
                <label for="checkbox2-C">Repeatedly receiving unwanted promotion information</label>
             </div>
             <div>
                <input type="checkbox" name="checkbox2" id="checkbox2-D" value="Difficulty in redeeming points">
                <label for="checkbox2-D">Difficulty in redeeming points</label>
             </div>
             <div class="others">
                <input type="checkbox" name="checkbox2" id="checkbox2-others">
                <label for="checkbox2-others">Others</label>
             </div>
           </div>
           <input type="text" value="" class="others-text" id="checkbox2-others-text">
        </div>
        <div class="interaction">
          <p>[Website - Order and Payment Process]</p>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" name="checkbox3" id="checkbox3-A" value="Inconvenient shopping cart operation">
              <label for="checkbox3-A">Inconvenient shopping cart operation</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox3" id="checkbox3-B" value="Difficulty in filling out order address">
              <label for="checkbox3-B">Difficulty in filling out order address</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox3" id="checkbox3-C" value="Complex payment process">
              <label for="checkbox3-C">Complex payment process</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox3" id="checkbox3-D" value="Lack of payment methods">
              <label for="checkbox3-D">Lack of payment methods</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox3" id="checkbox3-E" value="Checkout page issues (e.g., payment failures)">
              <label for="checkbox3-E">Checkout page issues (e.g., payment failures)</label>
            </div>
            <div class="others">
              <input type="checkbox" name="checkbox3" id="checkbox3-others">
              <label for="checkbox3-others">Others</label>
            </div>
          </div>
          <input type="text" value="" class="others-text" id="checkbox3-others-text">
        </div>
        <div class="product">
          <p>[Product]</p>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-A" value="Poor quality">
               <label for="checkbox4-A">Poor quality</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-B" value="Unpleasant odor">
               <label for="checkbox4-B">Unpleasant odor</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-C" value="Limited variety of styles">
               <label for="checkbox4-C">Limited variety of styles</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-D" value="Physical products not matching descriptions (size, model, color, etc.)">
               <label for="checkbox4-D">Physical products not matching descriptions (size, model, color, etc.)</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-E" value="Low cost-effectiveness">
               <label for="checkbox4-E">Low cost-effectiveness</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-F" value="Complicated machine operation, difficult to use">
               <label for="checkbox4-F">Complicated machine operation, difficult to use</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox4" id="checkbox4-G" value="Poor machine functionality, difficult to operate">
               <label for="checkbox4-G">Poor machine functionality, difficult to operate</label>
            </div>
            <div class="others">
              <input type="checkbox" name="checkbox4" id="checkbox4-others">
               <label for="checkbox4-others">Others</label>
              </div>
          </div>
          <input type="text" value="" class="others-text" id="checkbox4-others-text">
        </div>
        <div class="logistics">
          <p>[Logistics]</p>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-A" value="Long wait for shipping">
               <label for="checkbox5-A">Long wait for shipping</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-B" value="Long delivery times">
               <label for="checkbox5-B">Long delivery times</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-C" value="Expensive shipping fees">
               <label for="checkbox5-C">Expensive shipping fees</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-D" value="Can not track and check the logistics information">
               <label for="checkbox5-D">Can not track and check the logistics information</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-E" value="Poor quality of product packaging">
               <label for="checkbox5-E">Poor quality of product packaging</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox5" id="checkbox5-F" value="Limited logistics methods">
               <label for="checkbox5-F">Limited logistics methods</label> 
            </div>
            <div class="others">
               <input type="checkbox" name="checkbox5" id="checkbox5-others">
               <label for="checkbox5-others">Others</label>
            </div>
          </div>
          <input type="text" value="" class="others-text" id="checkbox5-others-text">
        </div>
        <div class="service">
          <p>[Customer Service]</p>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-A" value="Difficulty finding desired FAQs">
               <label for="checkbox6-A">Difficulty finding desired FAQs</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-B" value="FAQs unable to resolve issues">
               <label for="checkbox6-B">FAQs unable to resolve issues</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-C" value="Unfriendly policies (e.g., return/exchange policies, product warranty period)">
               <label for="checkbox6-C">Unfriendly policies (e.g., return/exchange policies, product warranty period)</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-D" value="Complicated process">
               <label for="checkbox6-D">Complicated process</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-E" value="Slow response">
               <label for="checkbox6-E">Slow response</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-F" value="Poor attitude">
               <label for="checkbox6-F">Poor attitude</label>
            </div>
            <div>
              <input type="checkbox" name="checkbox6" id="checkbox6-G" value="Low resolution efficiency">
               <label for="checkbox6-G">Low resolution efficiency</label>  
            </div>
            <div class="others">
              <input type="checkbox" name="checkbox6" id="checkbox6-others">
               <label for="checkbox6-others">Others</label>
            </div>
          </div>
          <input type="text" value="" class="others-text" id="checkbox6-others-text">
        </div>
      </div>
    </div>
  </div>
  <div class="rate-footer">
    <div class="rate-button">
      <span>Submit</span>
    </div>
    <div class="rate-load" id="loading_draw" style="display:none">
      <div class="loading-svg">
         <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
        </svg>
      </div>
    </div>
    <div class="success"><span>✔</span>Thank you for your feedback! Survey submitted!</div>
    <div class="error"><span>!</span>Please fill in the required information.</div>
  </div>
</div>
<div class="fn-mask">
  <span></span>
</div>
<script>
    var rateDoc = $('.gradual .rate');
    var windowWidth = $(window).width()  //获取当前屏幕分辨率
	if(windowWidth <= 1024){
       $(function () {
          rateDoc.click(function () {
            var name = $(this).parent().siblings('input').attr('name');
            if(name == 'recommend'){
               $(this).addClass("active").prevAll().addClass("active");
               $(this).nextAll().removeClass("active");
            }else{
                $(this).addClass("active1").prevAll().addClass("active1");
               $(this).nextAll().removeClass("active1");
            }
            let index = $(this).index();
            var rate = $(this).parent().siblings('input').attr('value', index);
            var radioName = '.'+ $(this).parent().siblings('input').attr('name');  
            var num = Number($(this).parent().siblings('input').val())+1 ;
            if(radioName != '.recommend'){
               if(num <= 7 ){
                $(radioName).css('display','block')
                $('.rate-select').css('display','block')
              }else{
                 $(radioName).find("input[type='checkbox']").attr('checked', false) 
                 $(radioName).find("input[type='text']").val('').hide()
                 $(radioName).css('display','none')
              }
            }
            var arr = []
            $('.select-qusetion>div').map(function(index,item){
                arr.push($(item).attr('style'))
            })
            var flag = true;
            arr.map(function(i){
                if(i != 'display: none;' && i != undefined){
                    flag = false
                }
            })
            if(flag == true){
                $('.rate-select').css('display','none')
            }
          });
         })
    }else{
       $(function () {
        rateDoc.hover(function () {
            var name = $(this).parent().siblings('input').attr('name');
            if(name == 'recommend'){
               $(this).addClass("active").prevAll().addClass("active");
               $(this).nextAll().removeClass("active");
            }else{
                $(this).addClass("active1").prevAll().addClass("active1");
               $(this).nextAll().removeClass("active1");
            }
           
        }, function () {
            let i = parseInt($(this).parent().siblings('input').val());
            var name = $(this).parent().siblings('input').attr('name');
           if(name == 'recommend'){
               if (i === -1) {
                $(this).removeClass("active").siblings().removeClass("active");
            } else {
                $(this).parent().children().eq(i).addClass("active").prevAll().addClass("active");
                $(this).parent().children().eq(i).nextAll().removeClass("active");
            }
           }else{
               if (i === -1) {
                $(this).removeClass("active1").siblings().removeClass("active1");
            } else {
                $(this).parent().children().eq(i).addClass("active1").prevAll().addClass("active1");
                $(this).parent().children().eq(i).nextAll().removeClass("active1");
            }
           }
          
        });
        rateDoc.click(function () {
            let index = $(this).index();
            var rate = $(this).parent().siblings('input').attr('value', index);
            var radioName = '.'+ $(this).parent().siblings('input').attr('name');  
            var num = Number($(this).parent().siblings('input').val())+1 ;
            if(radioName != '.recommend'){
               if(num <= 7 ){
                $(radioName).css('display','block')
                $('.rate-select').css('display','block')
              }else{
                 $(radioName).find("input[type='checkbox']").attr('checked', false) 
                 $(radioName).find("input[type='text']").val('').hide()
                 $(radioName).css('display','none')
              }
            }
            var arr = []
            $('.select-qusetion>div').map(function(index,item){
                arr.push($(item).attr('style'))
            })
            var flag = true;
            arr.map(function(i){
                if(i != 'display: none;' && i != undefined){
                    flag = false
                }
            })
            if(flag == true){
                $('.rate-select').css('display','none')
               $('.rate-footer .error').hide();
            }
        });
       })
    }
   $(function () {
      $('.icon-close').click(function(){
        getClose()     
      })
      $('.question-btn').click(function(){
        $('.fn-questionnaire,.fn-mask').show()
        $('body').css('overflow','hidden')
      })
       function getClose(){
         $("input[type='checkbox']").attr('checked',false)
         $("input[type='text']").val('')
         $("input[type='hidden']").val('-1')
         $('.gradual .rate').each(function(index,item){
           if($(item).hasClass('active')){
              $(item).removeClass('active')
           }else{
             $(item).removeClass('active1')
           }
         })
         $('.rate-select,.select-qusetion>div,.fn-questionnaire,.fn-mask,.rate-load,.rate-footer .success,.rate-footer .error,.others-text').hide()
         $('body').css('overflow','auto')
         $('.rate-button').show().children().text('Submit')
       }
        // 多选框加选中标记
        $("input[type='checkbox']").click(function(){
            if($(this).is(':checked')){
                $(this).attr('checked',true)
            }else{
                $(this).attr('checked',false)
            }
        })
        $('.others').click(function(){
            if($(this).children("input[type='checkbox']").is(':checked')){
                $(this).parent().next().show()
            }else{
                $(this).parent().next().val('')
                $(this).parent().next().hide()
            }
        })
       
       $('.rate-button').click(function(){
         if($('.rate-button>span').text().indexOf('Finish') != -1){
           getClose()
           return false;
         }
         var recommend = 0;
         var websiteInteraction = 0;
         var product = 0;
         var logistics = 0;
         var customerService = 0;
         var websiteShopPage = "";
         var websitePromotion = "";
         var websiteOrderPay = "";
         var productSuggest = "";
         var logisticsSuggest = "";
         var customerServiceSuggest = "";
         var inputName;
         
         var arr1=[]
         var arr2=[]
         var arr3=[]
         var arr4=[]
         var arr5=[]
         var arr6=[]
         $('.gradual').siblings('input').map(function(index,item){
           var num = $(item).val();
           if(Number(num)+1 == 0 || Number(num)+1 <= 7){
              inputName = $(item).attr('name')
              $('.select-qusetion>div').each(function(index,item){
                 if($(item).attr('class') == inputName){
                   if(!$(this).find("input[type='checkbox']").is(':checked')){
                      $('.rate-footer .error').show();
                      return false;
                   }else{
                      $('.rate-footer .error').hide();
                     if(inputName == 'interaction'){
                       $("input[name='checkbox1']:checked").each(function(index,item){
                         if($(item).attr('id') == 'checkbox1-others'){
                           var otherText = $('#checkbox1-others-text').val();
                           if(otherText == undefined || otherText == ''){
                              $('.rate-footer .error').show();
                              return false;
                           }else{
                             $("input[id='checkbox1-others']").val(otherText)
                           }
                         }
                       arr1.push($(item).val())
                     })
                       $("input[name='checkbox2']:checked").each(function(index,item){
                       if($(item).attr('id') == 'checkbox2-others'){
                         var otherText = $('#checkbox2-others-text').val();
                         if(otherText == undefined || otherText == ''){
                            $('.rate-footer .error').show();
                            return false;
                         }else{
                           $("input[id='checkbox2-others']").val(otherText)
                         }
                       }
                       arr2.push($(item).val())
                     })
                       $("input[name='checkbox3']:checked").each(function(index,item){
                       if($(item).attr('id') == 'checkbox3-others'){
                         var otherText = $('#checkbox3-others-text').val();
                         if(otherText == undefined || otherText == ''){
                           //这里没用
                            $('.rate-footer .error').show();
                            return false;
                         }else{
                           $("input[id='checkbox3-others']").val(otherText)
                         }
                       }
                       arr3.push($(item).val())
                     })
                   }
                     else if(inputName == 'product'){
                      $("input[name='checkbox4']:checked").each(function(index,item){
                       if($(item).attr('id') == 'checkbox4-others'){
                         var otherText = $('#checkbox4-others-text').val();
                         if(otherText == undefined || otherText == ''){
                            $('.rate-footer .error').show();
                            return false;
                         }else{
                           $("input[id='checkbox4-others']").val(otherText)
                         }
                       }
                       arr4.push($(item).val())
                     })
                   }
                     else if(inputName == 'logistics'){
                      $("input[name='checkbox5']:checked").each(function(index,item){
                       if($(item).attr('id') == 'checkbox5-others'){
                         var otherText = $('#checkbox5-others-text').val();
                         if(otherText == undefined || otherText == ''){
                            $('.rate-footer .error').show();
                            return false;
                         }else{
                           $("input[id='checkbox5-others']").val(otherText)
                         }
                       }
                       arr5.push($(item).val())
                     })
                   }
                     else if(inputName == 'service'){
                      $("input[name='checkbox6']:checked").each(function(index,item){
                       if($(item).attr('id') == 'checkbox6-others'){
                         var otherText = $('#checkbox6-others-text').val();
                         if(otherText == undefined || otherText == ''){
                            $('.rate-footer .error').show();
                            return false;
                         }else{
                           $("input[id='checkbox6-others']").val(otherText)
                             return flagError = true
                         }
                       }                   
                      arr6.push($(item).val())
                     })
                   }else{
                       $('.rate-footer .error').hide();
                   }
                 }
               }
             }) 
           }
         })
         var uniqueArray1 = Array.from(new Set(arr1));
         var uniqueArray2 = Array.from(new Set(arr2));
         var uniqueArray3 = Array.from(new Set(arr3));
         var uniqueArray4 = Array.from(new Set(arr4));
         var uniqueArray5 = Array.from(new Set(arr5));
         var uniqueArray6 = Array.from(new Set(arr6));
          for (var i = 0; i < uniqueArray1.length; i++) {
              websiteShopPage += uniqueArray1[i]+ ",";
          }
          for (var i = 0; i < uniqueArray2.length; i++) {
              websitePromotion += uniqueArray2[i]+ ",";
          }
          for (var i = 0; i < uniqueArray3.length; i++) {
              websiteOrderPay += uniqueArray3[i]+ ",";
          } 
         for (var i = 0; i < uniqueArray4.length; i++) {
              productSuggest += uniqueArray4[i]+ ",";
          }
          for (var i = 0; i < uniqueArray5.length; i++) {
              logisticsSuggest += uniqueArray5[i]+ ",";
          }
          for (var i = 0; i < uniqueArray6.length; i++) {
              customerServiceSuggest += uniqueArray6[i]+ ",";
          }
          if (websiteShopPage.length > 0 || websitePromotion.length > 0 || websiteOrderPay.length > 0 || productSuggest.length > 0 || logisticsSuggest.length > 0 || customerServiceSuggest.length > 0) {
            websiteShopPage = websiteShopPage.substr(0, websiteShopPage.length - 1);
            websitePromotion = websitePromotion.substr(0, websitePromotion.length - 1);
            websiteOrderPay = websiteOrderPay.substr(0, websiteOrderPay.length - 1);  
            productSuggest = productSuggest.substr(0, productSuggest.length - 1);
            logisticsSuggest = logisticsSuggest.substr(0, logisticsSuggest.length - 1);
            customerServiceSuggest = customerServiceSuggest.substr(0, customerServiceSuggest.length - 1);
          }
         recommend = Number($("input[name='recommend']").val()) + 1
         websiteInteraction = Number($("input[name='interaction']").val()) + 1
         product = Number($("input[name='product']").val()) + 1
         logistics = Number($("input[name='logistics']").val()) + 1
         customerService = Number($("input[name='service']").val()) + 1
         var data = {
           "recommend":recommend,
           "websiteInteraction":websiteInteraction,
           "product":product,
           "logistics":logistics,
           "customerService":customerService,
           'websiteShopPage':websiteShopPage,
           "websitePromotion":websitePromotion,
           "websiteOrderPay":websiteOrderPay,
           "productSuggest":productSuggest,
           "logisticsSuggest":logisticsSuggest,
           "customerServiceSuggest":customerServiceSuggest,
           "market":"US_HTVRONT(shopify)"
         }
         if($('.rate-footer .error').attr('style').indexOf('none') != -1){
          var jsonData = JSON.stringify(data)
          $('.rate-button').hide()
          $('.rate-load').show()
          $.ajax({
            url: "https://qn.htvront.com/user/questionnaire/submit",
            method: "POST",
            contentType: 'application/json',
            data: jsonData,
            success: function(res) {
              if(res.code == 200){
                $('.rate-button>span').text('Finish')
                $('.rate-footer .success').show()
                $('.rate-button').show()
                $('.rate-load').hide()
              }
            },
            error:function(xhr,status,error){
              $('.rate-button').show()
              $('.rate-load').hide()
              console.log(xhr,status,error)
            }
          })
         }
       })
    })
</script>
{% schema %}
  {
    "name": "Questionnaire",
    "settings": [
        {
        "type":"radio",
        "id":"question_set",
        "label":"问卷调查开关",
        "default": "false",
         "options": [
          {
            "value": "true",
            "label": "true"
          },
          {
            "value": "false",
            "label": "false"
          }
        ]
      },
      {
        "type":"text",
        "id":"title",
        "label":"title"
      },{
        "type":"html",
        "id":"desc",
        "label":"desc"
      }
    ],
    "presets":[
        {
          "name":"Questionnaire-Survey"
        }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}