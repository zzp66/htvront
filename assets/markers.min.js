/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/photo-sphere-viewer@4.6.4/dist/plugins/markers.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
* Photo Sphere Viewer 4.6.4
* @copyright 2014-2015 Jérémy Heleine
* @copyright 2015-2022 Damien "Mistic" Sorel
* @licence MIT (https://opensource.org/licenses/MIT)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three"),require("photo-sphere-viewer"),require("uevent")):"function"==typeof define&&define.amd?define(["exports","three","photo-sphere-viewer","uevent"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).PhotoSphereViewer=t.PhotoSphereViewer||{},t.PhotoSphereViewer.MarkersPlugin={}),t.THREE,t.PhotoSphereViewer)}(this,(function(t,e,i){"use strict";function s(){return s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},s.apply(this,arguments)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}function o(t,e){return o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},o(t,e)}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var h='<svg xmlns="http://www.w3.org/2000/svg" viewBox="9 9 81 81"><path fill="currentColor" d="M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',a={GOTO_MARKER_DONE:"goto-marker-done",LEAVE_MARKER:"leave-marker",OVER_MARKER:"over-marker",RENDER_MARKERS_LIST:"render-markers-list",SELECT_MARKER:"select-marker",SELECT_MARKER_LIST:"select-marker-list",UNSELECT_MARKER:"unselect-marker",HIDE_MARKERS:"hide-markers",SET_MARKERS:"set-markers",SHOW_MARKERS:"show-markers"},l="http://www.w3.org/2000/svg",p="psvMarker",c="marker",u="markersList",g=function(t,e,i){return'\n<div class="psv-panel-menu psv-panel-menu--stripped">\n  <h1 class="psv-panel-menu-title">'+h+" "+e+'</h1>\n  <ul class="psv-panel-menu-list">\n    '+t.map((function(t){return"\n    <li data-"+i+'="'+t.config.id+'" class="psv-panel-menu-item" tabindex="0">\n      '+("image"===t.type?'<span class="psv-panel-menu-item-icon"><img src="'+t.config.image+'"/></span>':"")+'\n      <span class="psv-panel-menu-item-label">'+t.getListContent()+"</span>\n    </li>\n    "})).join("")+"\n  </ul>\n</div>\n"};function d(t){this.message=t,"captureStackTrace"in Error?Error.captureStackTrace(this,d):this.stack=(new Error).stack}function f(t,e,s){var r=t[0],o=t[1],n=e[0],h=e[1],a=i.utils.greatArcDistance(t,e),l=Math.sin((1-s)*a)/Math.sin(a),p=Math.sin(s*a)/Math.sin(a),c=l*Math.cos(o)*Math.cos(r)+p*Math.cos(h)*Math.cos(n),u=l*Math.cos(o)*Math.sin(r)+p*Math.cos(h)*Math.sin(n),g=l*Math.sin(o)+p*Math.sin(h);return[Math.atan2(u,c),Math.atan2(g,Math.sqrt(c*c+u*u))]}d.prototype=Object.create(Error.prototype),d.prototype.name="PSVError",d.prototype.constructor=d,new e.Quaternion;var v={image:"image",imageLayer:"imageLayer",html:"html",polygonPx:"polygonPx",polygonRad:"polygonRad",polylinePx:"polylinePx",polylineRad:"polylineRad",square:"square",rect:"rect",circle:"circle",ellipse:"ellipse",path:"path"},k=function(){function t(s,r){if(!s.id)throw new i.PSVError("missing marker id");this.psv=r,this.id=s.id,this.type=t.getType(s,!1),this.visible=!0,this.$el=null,this.config={},this.data=void 0,this.tooltip=null,this.props={dynamicSize:!1,anchor:null,position:null,position2D:null,positions3D:null,width:null,height:null,def:null},this.loader=null,this.is3d()&&(this.loader=new e.TextureLoader,this.psv.config.withCredentials&&this.loader.setWithCredentials(!0),this.psv.config.requestHeaders&&"object"==typeof this.psv.config.requestHeaders&&this.loader.setRequestHeader(this.psv.config.requestHeaders)),this.isNormal()?this.$el=document.createElement("div"):this.isPolygon()?this.$el=document.createElementNS(l,"polygon"):this.isPolyline()?this.$el=document.createElementNS(l,"polyline"):this.isSvg()&&(this.$el=document.createElementNS(l,this.type)),this.is3d()||(this.$el.id="psv-marker-"+this.id,this.$el.psvMarker=this),this.update(s)}var s=t.prototype;return s.destroy=function(){delete this.$el.psvMarker,delete this.$el,delete this.config,delete this.props,delete this.psv},s.is3d=function(){return this.type===v.imageLayer},s.isNormal=function(){return this.type===v.image||this.type===v.html},s.isPoly=function(){return this.isPolygon()||this.isPolyline()},s.isPolyPx=function(){return this.type===v.polygonPx||this.type===v.polylinePx},s.isPolyRad=function(){return this.type===v.polygonRad||this.type===v.polylineRad},s.isPolygon=function(){return this.type===v.polygonPx||this.type===v.polygonRad},s.isPolyline=function(){return this.type===v.polylinePx||this.type===v.polylineRad},s.isSvg=function(){return this.type===v.square||this.type===v.rect||this.type===v.circle||this.type===v.ellipse||this.type===v.path},s.getScale=function(t,s){if(!this.config.scale)return 1;if("function"==typeof this.config.scale)return this.config.scale(t,s);var r,o,n=1;if(Array.isArray(this.config.scale.zoom)){var h=this.config.scale.zoom;n*=h[0]+(h[1]-h[0])*i.CONSTANTS.EASINGS.inQuad(t/100)}if(Array.isArray(this.config.scale.longitude)){var a=this.config.scale.longitude,l=e.MathUtils.degToRad(this.psv.prop.hFov)/2,p=Math.abs((r=this.props.position.longitude,o=s.longitude,[0,2*Math.PI,2*-Math.PI].reduce((function(t,e){var i=o-r+e;return Math.abs(i)<Math.abs(t)?i:t}),1/0)));n*=a[1]+(a[0]-a[1])*i.CONSTANTS.EASINGS.outQuad(Math.max(0,(l-p)/l))}return n},s.getListContent=function(){var t;return this.config.listContent?this.config.listContent:null!=(t=this.config.tooltip)&&t.content?this.config.tooltip.content:this.config.html?this.config.html:this.id},s.showTooltip=function(t){var e;if(this.visible&&null!=(e=this.config.tooltip)&&e.content&&this.props.position2D){var s={content:this.config.tooltip.content,position:this.config.tooltip.position,data:this};if(this.isPoly()){var r=i.utils.getPosition(this.psv.container);s.box={width:2*this.psv.tooltip.size.arrow,height:2*this.psv.tooltip.size.arrow},t?(s.top=t.clientY-r.top-this.psv.tooltip.size.arrow/2,s.left=t.clientX-r.left-this.psv.tooltip.size.arrow):(s.top=this.props.position2D.y,s.left=this.props.position2D.x)}else s.top=this.props.position2D.y,s.left=this.props.position2D.x,s.box={width:this.props.width,height:this.props.height};this.tooltip?this.tooltip.move(s):this.tooltip=this.psv.tooltip.create(s)}},s.hideTooltip=function(){this.tooltip&&(this.tooltip.hide(),this.tooltip=null)},s.update=function(e){var s,r,o=t.getType(e,!0);if(void 0!==o&&o!==this.type)throw new i.PSVError("cannot change marker type");(i.utils.deepmerge(this.config,e),"string"==typeof this.config.tooltip&&(this.config.tooltip={content:this.config.tooltip}),this.data=this.config.data,this.visible=!1!==this.config.visible,this.is3d())||(this.isNormal()?this.$el.setAttribute("class","psv-marker psv-marker--normal"):this.$el.setAttribute("class","psv-marker psv-marker--svg"),this.config.className&&i.utils.addClasses(this.$el,this.config.className),this.config.tooltip&&i.utils.addClasses(this.$el,"psv-marker--has-tooltip"),this.config.content&&i.utils.addClasses(this.$el,"psv-marler--has-content"),this.$el.style.opacity=null!=(s=this.config.opacity)?s:1,this.config.style&&i.utils.deepmerge(this.$el.style,this.config.style));this.props.anchor=i.utils.parsePosition(this.config.anchor),this.config.scale&&("number"==typeof this.config.scale&&(r="Single value marker scale is deprecated, please use an array of two values.",console.warn("PhotoSphereViewer: "+r),this.config.scale={zoom:[0,this.config.scale]}),Array.isArray(this.config.scale)&&(this.config.scale={zoom:this.config.scale})),this.isNormal()?this.__updateNormal():this.isPoly()?this.__updatePoly():this.isSvg()?this.__updateSvg():this.is3d()&&this.__update3d()},s.__updateNormal=function(){if(!i.utils.isExtendedPosition(this.config))throw new i.PSVError("missing marker position, latitude/longitude or x/y");if(this.config.image&&(!this.config.width||!this.config.height))throw new i.PSVError("missing marker width/height");this.config.width&&this.config.height?(this.props.dynamicSize=!1,this.props.width=this.config.width,this.props.height=this.config.height,this.$el.style.width=this.config.width+"px",this.$el.style.height=this.config.height+"px"):this.props.dynamicSize=!0,this.config.image?(this.props.def=this.config.image,this.$el.style.backgroundImage="url("+this.config.image+")"):this.config.html&&(this.props.def=this.config.html,this.$el.innerHTML=this.config.html),this.$el.style.transformOrigin=100*this.props.anchor.x+"% "+100*this.props.anchor.y+"%",this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},s.__updateSvg=function(){var t=this;if(!i.utils.isExtendedPosition(this.config))throw new i.PSVError("missing marker position, latitude/longitude or x/y");switch(this.props.dynamicSize=!0,this.type){case v.square:this.props.def={x:0,y:0,width:this.config.square,height:this.config.square};break;case v.rect:Array.isArray(this.config.rect)?this.props.def={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}:this.props.def={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height};break;case v.circle:this.props.def={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case v.ellipse:Array.isArray(this.config.ellipse)?this.props.def={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}:this.props.def={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry};break;case v.path:this.props.def={d:this.config.path}}i.utils.each(this.props.def,(function(e,i){t.$el.setAttributeNS(null,i,e)})),this.config.svgStyle?i.utils.each(this.config.svgStyle,(function(e,s){t.$el.setAttributeNS(null,i.utils.dasherize(s),e)})):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},s.__updatePoly=function(){var t=this;this.props.dynamicSize=!0,this.config.svgStyle?(i.utils.each(this.config.svgStyle,(function(e,s){t.$el.setAttributeNS(null,i.utils.dasherize(s),e)})),this.isPolyline()&&!this.config.svgStyle.fill&&this.$el.setAttributeNS(null,"fill","none")):this.isPolygon()?this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline()&&(this.$el.setAttributeNS(null,"fill","none"),this.$el.setAttributeNS(null,"stroke","rgb(0,0,0)"));var e=this.config.polygonPx||this.config.polygonRad||this.config.polylinePx||this.config.polylineRad;if(!Array.isArray(e[0]))for(var s=0;s<e.length;s++)e.splice(s,2,[e[s],e[s+1]]);this.isPolyPx()?this.props.def=e.map((function(e){var i=t.psv.dataHelper.textureCoordsToSphericalCoords({x:e[0],y:e[1]});return[i.longitude,i.latitude]})):this.props.def=e.map((function(t){return[i.utils.parseAngle(t[0]),i.utils.parseAngle(t[1],!0)]}));var r=this.isPolygon()?function(t){for(var e=[t[0]],s=0,r=1;r<t.length;r++){var o=t[r-1][0]-t[r][0];o>Math.PI?s+=1:o<-Math.PI&&(s-=1),e.push([t[r][0]+2*s*Math.PI,t[r][1]])}var n=e.reduce((function(t,e){return[t[0]+e[0],t[1]+e[1]]}));return[i.utils.parseAngle(n[0]/t.length),n[1]/t.length]}(this.props.def):function(t){for(var e=0,s=[],r=0;r<t.length-1;r++){var o=i.utils.greatArcDistance(t[r],t[r+1])*i.CONSTANTS.SPHERE_RADIUS;s.push(o),e+=o}for(var n=0,h=0;h<t.length-1;h++){if(n+s[h]>e/2){var a=(e/2-n)/s[h];return f(t[h],t[h+1],a)}n+=s[h]}return t[Math.round(t.length/2)]}(this.props.def);this.props.position={longitude:r[0],latitude:r[1]},this.props.positions3D=this.props.def.map((function(e){return t.psv.dataHelper.sphericalCoordsToVector3({longitude:e[0],latitude:e[1]})}))},s.__update3d=function(){var t=this;if(!this.config.width||!this.config.height)throw new i.PSVError("missing marker width/height");if(this.props.dynamicSize=!1,this.props.width=this.config.width,this.props.height=this.config.height,this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)],this.type===v.imageLayer){if(!this.$el){var s,r,o=new e.MeshBasicMaterial({transparent:!0,opacity:null!=(s=this.config.opacity)?s:1,depthTest:!1}),n=new e.PlaneGeometry(1,1),h=new e.Mesh(n,o);h.userData=((r={}).psvMarker=this,r),this.$el=(new e.Group).add(h),Object.defineProperty(this.$el,"visible",{enumerable:!0,get:function(){return this.children[0].userData.psvMarker.visible},set:function(t){this.children[0].userData.psvMarker.visible=t}})}switch(this.props.def!==this.config.imageLayer&&(this.psv.config.requestHeaders&&"function"==typeof this.psv.config.requestHeaders&&this.loader.setRequestHeader(this.psv.config.requestHeaders(this.config.imageLayer)),this.$el.children[0].material.map=this.loader.load(this.config.imageLayer,(function(e){e.anisotropy=4,t.psv.needsUpdate()})),this.props.def=this.config.imageLayer),this.$el.children[0].position.set(this.props.anchor.x-.5,this.props.anchor.y-.5,0),this.$el.position.copy(this.props.positions3D[0]),this.config.orientation){case"horizontal":this.$el.lookAt(0,this.$el.position.y,0),this.$el.rotateX(this.props.position.latitude<0?-Math.PI/2:Math.PI/2);break;case"vertical-left":this.$el.lookAt(0,0,0),this.$el.rotateY(.4*-Math.PI);break;case"vertical-right":this.$el.lookAt(0,0,0),this.$el.rotateY(.4*Math.PI);break;default:this.$el.lookAt(0,0,0)}this.$el.scale.set(this.config.width/100,this.config.height/100,1)}},t.getType=function(t,e){void 0===e&&(e=!1);var s=[];if(i.utils.each(v,(function(e){t[e]&&s.push(e)})),0===s.length&&!e)throw new i.PSVError("missing marker content, either "+Object.keys(v).join(", "));if(s.length>1)throw new i.PSVError("multiple marker content, either "+Object.keys(v).join(", "));return s[0]},t}(),y=function(t){function e(e){var i;return(i=t.call(this,e,"psv-button--hover-scale psv-markers-button",!0)||this).plugin=i.psv.getPlugin("markers"),i.plugin&&(i.plugin.on(a.SHOW_MARKERS,n(i)),i.plugin.on(a.HIDE_MARKERS,n(i)),i.toggleActive(!0)),i.hide(),i}r(e,t);var i=e.prototype;return i.destroy=function(){this.plugin&&(this.plugin.off(a.SHOW_MARKERS,this),this.plugin.off(a.HIDE_MARKERS,this)),t.prototype.destroy.call(this)},i.isSupported=function(){return!!this.plugin},i.handleEvent=function(t){switch(t.type){case a.SHOW_MARKERS:this.toggleActive(!0);break;case a.HIDE_MARKERS:this.toggleActive(!1)}},i.onClick=function(){this.plugin.prop.visible?this.plugin.hide():this.plugin.show()},e}(i.AbstractButton);y.id="markers",y.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 9 81 81"><path fill="currentColor" d="M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n';var m=function(t){function e(e){var s;return(s=t.call(this,e,"psv-button--hover-scale psv-markers-list-button",!0)||this).plugin=s.psv.getPlugin("markers"),s.plugin&&(s.psv.on(i.CONSTANTS.EVENTS.OPEN_PANEL,n(s)),s.psv.on(i.CONSTANTS.EVENTS.CLOSE_PANEL,n(s))),s.hide(),s}r(e,t);var s=e.prototype;return s.destroy=function(){this.psv.off(i.CONSTANTS.EVENTS.OPEN_PANEL,this),this.psv.off(i.CONSTANTS.EVENTS.CLOSE_PANEL,this),t.prototype.destroy.call(this)},s.isSupported=function(){return!!this.plugin},s.handleEvent=function(t){switch(t.type){case i.CONSTANTS.EVENTS.OPEN_PANEL:this.toggleActive(t.args[0]===u);break;case i.CONSTANTS.EVENTS.CLOSE_PANEL:this.toggleActive(!1)}},s.onClick=function(){this.plugin.toggleMarkersList()},e}(i.AbstractButton);m.id="markersList",m.icon=h,i.DEFAULTS.lang[y.id]="Markers",i.DEFAULTS.lang[m.id]="Markers list",i.registerButton(y,"caption:left"),i.registerButton(m,"caption:left");var E=function(t){function o(e,r){var o;return(o=t.call(this,e)||this).markers={},o.prop={visible:!0,currentMarker:null,hoveringMarker:null,stopObserver:null},o.config=s({clickEventOnMarker:!1},r),!1!==(null==r?void 0:r.listButton)&&!1!==(null==r?void 0:r.hideButton)||i.utils.logWarn("MarkersPlugin: listButton and hideButton options are deprecated. Please define the global navbar options according to your needs."),o.container=document.createElement("div"),o.container.className="psv-markers",o.container.style.cursor=o.psv.config.mousemove?"move":"default",o.svgContainer=document.createElementNS(l,"svg"),o.svgContainer.setAttribute("class","psv-markers-svg-container"),o.container.appendChild(o.svgContainer),o.container.addEventListener("mouseenter",n(o),!0),o.container.addEventListener("mouseleave",n(o),!0),o.container.addEventListener("mousemove",n(o),!0),o.container.addEventListener("contextmenu",n(o)),o}r(o,t);var h=o.prototype;return h.init=function(){var e=this;t.prototype.init.call(this),this.psv.container.appendChild(this.container),this.psv.on(i.CONSTANTS.EVENTS.CLICK,this),this.psv.on(i.CONSTANTS.EVENTS.DOUBLE_CLICK,this),this.psv.on(i.CONSTANTS.EVENTS.RENDER,this),this.psv.on(i.CONSTANTS.EVENTS.CONFIG_CHANGED,this),this.config.markers&&this.psv.once(i.CONSTANTS.EVENTS.READY,(function(){e.setMarkers(e.config.markers),delete e.config.markers}))},h.destroy=function(){var e,s;this.clearMarkers(!1),null==(e=(s=this.prop).stopObserver)||e.call(s),this.psv.off(i.CONSTANTS.EVENTS.CLICK,this),this.psv.off(i.CONSTANTS.EVENTS.DOUBLE_CLICK,this),this.psv.off(i.CONSTANTS.EVENTS.RENDER,this),this.psv.off(i.CONSTANTS.EVENTS.CONFIG_CHANGED,this),this.psv.container.removeChild(this.container),delete this.svgContainer,delete this.markers,delete this.container,t.prototype.destroy.call(this)},h.handleEvent=function(t){switch(t.type){case"mouseenter":this.__onMouseEnter(t,this.__getTargetMarker(t.target));break;case"mouseleave":this.__onMouseLeave(t,this.__getTargetMarker(t.target));break;case"mousemove":this.__onMouseMove(t,this.__getTargetMarker(t.target));break;case"contextmenu":t.preventDefault();break;case i.CONSTANTS.EVENTS.CLICK:this.__onClick(t,t.args[0],!1);break;case i.CONSTANTS.EVENTS.DOUBLE_CLICK:this.__onClick(t,t.args[0],!0);break;case i.CONSTANTS.EVENTS.RENDER:this.renderMarkers();break;case i.CONSTANTS.OBJECT_EVENTS.ENTER_OBJECT:this.__onMouseEnter(t.detail.originalEvent,t.detail.data);break;case i.CONSTANTS.OBJECT_EVENTS.LEAVE_OBJECT:this.__onMouseLeave(t.detail.originalEvent,t.detail.data);break;case i.CONSTANTS.OBJECT_EVENTS.HOVER_OBJECT:this.__onMouseMove(t.detail.originalEvent,t.detail.data);break;case i.CONSTANTS.EVENTS.CONFIG_CHANGED:this.container.style.cursor=this.psv.config.mousemove?"move":"default"}},h.show=function(){this.prop.visible=!0,this.renderMarkers(),this.trigger(a.SHOW_MARKERS)},h.hide=function(){this.prop.visible=!1,this.renderMarkers(),this.trigger(a.HIDE_MARKERS)},h.toggleAllTooltips=function(){this.prop.showAllTooltips=!this.prop.showAllTooltips,this.renderMarkers()},h.showAllTooltips=function(){this.prop.showAllTooltips=!0,this.renderMarkers()},h.hideAllTooltips=function(){this.prop.showAllTooltips=!1,this.renderMarkers()},h.getNbMarkers=function(){return Object.keys(this.markers).length},h.getMarkers=function(){return Object.values(this.markers)},h.addMarker=function(t,e){if(void 0===e&&(e=!0),this.markers[t.id])throw new i.PSVError('marker "'+t.id+'" already exists');var s=new k(t,this.psv);return s.isNormal()?this.container.appendChild(s.$el):s.isPoly()||s.isSvg()?this.svgContainer.appendChild(s.$el):s.is3d()&&this.psv.renderer.scene.add(s.$el),this.markers[s.id]=s,e&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers())),s},h.getMarker=function(t){var e="object"==typeof t?t.id:t;if(!this.markers[e])throw new i.PSVError('cannot find marker "'+e+'"');return this.markers[e]},h.getCurrentMarker=function(){return this.prop.currentMarker},h.updateMarker=function(t,e){void 0===e&&(e=!0);var i=this.getMarker(t.id);return i.update(t),e&&(this.renderMarkers(),this.__refreshUi(),i.is3d()&&this.psv.needsUpdate(),this.trigger(a.SET_MARKERS,this.getMarkers())),i},h.removeMarker=function(t,e){void 0===e&&(e=!0);var i=this.getMarker(t);i.isNormal()?this.container.removeChild(i.$el):i.isPoly()||i.isSvg()?this.svgContainer.removeChild(i.$el):i.is3d()&&(this.psv.renderer.scene.remove(i.$el),this.psv.needsUpdate()),this.prop.hoveringMarker===i&&(this.prop.hoveringMarker=null),this.prop.currentMarker===i&&(this.prop.currentMarker=null),i.hideTooltip(),i.destroy(),delete this.markers[i.id],e&&(this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.removeMarkers=function(t,e){var i=this;void 0===e&&(e=!0),t.forEach((function(t){return i.removeMarker(t,!1)})),e&&(this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.setMarkers=function(t,e){var s=this;void 0===e&&(e=!0),this.clearMarkers(!1),i.utils.each(t,(function(t){return s.addMarker(t,!1)})),e&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.clearMarkers=function(t){var e=this;void 0===t&&(t=!0),i.utils.each(this.markers,(function(t){return e.removeMarker(t,!1)})),t&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.gotoMarker=function(t,e){var i=this,r=this.getMarker(t);return this.psv.animate(s({},r.props.position,{speed:e})).then((function(){i.trigger(a.GOTO_MARKER_DONE,r)}))},h.hideMarker=function(t){this.toggleMarker(t,!1)},h.showMarker=function(t){this.toggleMarker(t,!0)},h.toggleMarker=function(t,e){void 0===e&&(e=null);var i=this.getMarker(t);i.visible=null===e?!i.visible:e,i.is3d()?this.psv.needsUpdate():this.renderMarkers()},h.showMarkerPanel=function(t){var e,i=this.getMarker(t);null!=i&&null!=(e=i.config)&&e.content?this.psv.panel.show({id:c,content:i.config.content}):this.psv.panel.hide(c)},h.toggleMarkersList=function(){this.psv.panel.prop.contentId===u?this.hideMarkersList():this.showMarkersList()},h.showMarkersList=function(){var t=this,e=[];i.utils.each(this.markers,(function(t){t.visible&&!t.config.hideList&&e.push(t)})),e=this.change(a.RENDER_MARKERS_LIST,e),this.psv.panel.show({id:u,content:g(e,this.psv.config.lang[y.id],i.utils.dasherize(p)),noMargin:!0,clickHandler:function(e){var s=e.target?i.utils.getClosest(e.target,"li"):void 0,r=s?s.dataset.psvMarker:void 0;if(r){var o=t.getMarker(r);t.trigger(a.SELECT_MARKER_LIST,o),t.gotoMarker(o,1e3),t.hideMarkersList()}}})},h.hideMarkersList=function(){this.psv.panel.hide(u)},h.renderMarkers=function(){var t=this,e=this.psv.getZoomLevel(),s=this.psv.getPosition();i.utils.each(this.markers,(function(r){var o=t.prop.visible&&r.visible,n=null;if(o&&r.is3d())n=t.__getMarkerPosition(r),o=t.__isMarkerVisible(r,n);else if(o&&r.isPoly()){var h=t.__getPolyPositions(r);if(o=h.length>(r.isPolygon()?2:1)){n=t.__getMarkerPosition(r);var a=h.map((function(t){return t.x-n.x+","+(t.y-n.y)})).join(" ");r.$el.setAttributeNS(null,"points",a),r.$el.setAttributeNS(null,"transform","translate("+n.x+" "+n.y+")")}}else if(o&&(r.props.dynamicSize&&t.__updateMarkerSize(r),n=t.__getMarkerPosition(r),o=t.__isMarkerVisible(r,n))){var l=r.getScale(e,s);if(r.isSvg()){var p=n.x+r.props.width*r.props.anchor.x*(1-l),c=n.y+r.props.width*r.props.anchor.y*(1-l);r.$el.setAttributeNS(null,"transform","translate("+p+", "+c+") scale("+l+", "+l+")")}else r.$el.style.transform="translate3D("+n.x+"px, "+n.y+"px, 0px) scale("+l+", "+l+")"}r.props.position2D=o?n:null,r.is3d()||i.utils.toggleClass(r.$el,"psv-marker--visible",o),o&&(t.prop.showAllTooltips||r===t.prop.hoveringMarker&&!r.isPoly())?r.showTooltip():o&&r===t.prop.hoveringMarker||r.hideTooltip()}))},h.__isMarkerVisible=function(t,e){return t.props.positions3D[0].dot(this.psv.prop.direction)>0&&e.x+t.props.width>=0&&e.x-t.props.width<=this.psv.prop.size.width&&e.y+t.props.height>=0&&e.y-t.props.height<=this.psv.prop.size.height},h.__updateMarkerSize=function(t){var e;i.utils.addClasses(t.$el,"psv-marker--transparent"),t.isSvg()?(e=t.$el.getAttributeNS(null,"transform"),t.$el.removeAttributeNS(null,"transform")):(e=t.$el.style.transform,t.$el.style.transform="");var s=t.$el.getBoundingClientRect();t.props.width=s.width,t.props.height=s.height,i.utils.removeClasses(t.$el,"psv-marker--transparent"),e&&(t.isSvg()?t.$el.setAttributeNS(null,"transform",e):t.$el.style.transform=e),t.props.dynamicSize=!1},h.__getMarkerPosition=function(t){if(t.isPoly())return this.psv.dataHelper.sphericalCoordsToViewerCoords(t.props.position);var e=this.psv.dataHelper.vector3ToViewerCoords(t.props.positions3D[0]);return e.x-=t.props.width*t.props.anchor.x,e.y-=t.props.height*t.props.anchor.y,e},h.__getPolyPositions=function(t){var e=this,i=t.props.positions3D.length,s=t.props.positions3D.map((function(t){return{vector:t,visible:t.dot(e.psv.prop.direction)>0}})),r=[];return s.forEach((function(t,e){t.visible||[0===e?s[i-1]:s[e-1],e===i-1?s[0]:s[e+1]].forEach((function(i){i.visible&&r.push({visible:i,invisible:t,index:e})}))})),r.reverse().forEach((function(t){s.splice(t.index,0,{vector:e.__getPolyIntermediaryPoint(t.visible.vector,t.invisible.vector),visible:!0})})),s.filter((function(t){return t.visible})).map((function(t){return e.psv.dataHelper.vector3ToViewerCoords(t.vector)}))},h.__getPolyIntermediaryPoint=function(t,s){var r=this.psv.prop.direction.clone().normalize(),o=(new e.Vector3).crossVectors(t,s).normalize(),n=(new e.Vector3).crossVectors(o,t).normalize(),h=t.clone().multiplyScalar(-r.dot(n)),a=n.clone().multiplyScalar(r.dot(t)),l=(new e.Vector3).addVectors(h,a).normalize(),p=(new e.Vector3).crossVectors(l,r);return l.applyAxisAngle(p,.01).multiplyScalar(i.CONSTANTS.SPHERE_RADIUS)},h.__getTargetMarker=function(t,e){void 0===e&&(e=!1);var s=e?i.utils.getClosest(t,".psv-marker"):t;return s?s.psvMarker:void 0},h.__targetOnTooltip=function(t,e){return!(!t||!e)&&i.utils.hasParent(t,e.container)},h.__onMouseEnter=function(t,e){e&&!e.isPoly()&&(this.prop.hoveringMarker=e,this.trigger(a.OVER_MARKER,e),this.prop.showAllTooltips||e.showTooltip(t))},h.__onMouseLeave=function(t,e){!e||e.isPoly()&&this.__targetOnTooltip(t.relatedTarget,e.tooltip)||(this.trigger(a.LEAVE_MARKER,e),this.prop.hoveringMarker=null,this.prop.showAllTooltips||e.hideTooltip())},h.__onMouseMove=function(t,e){var i,s;null!=e&&e.isPoly()?s=e:this.prop.hoveringMarker&&this.__targetOnTooltip(t.target,this.prop.hoveringMarker.tooltip)&&(s=this.prop.hoveringMarker),s?(this.prop.hoveringMarker||(this.trigger(a.OVER_MARKER,s),this.prop.hoveringMarker=s),this.prop.showAllTooltips||s.showTooltip(t)):null!=(i=this.prop.hoveringMarker)&&i.isPoly()&&(this.trigger(a.LEAVE_MARKER,this.prop.hoveringMarker),this.prop.showAllTooltips||this.prop.hoveringMarker.hideTooltip(),this.prop.hoveringMarker=null)},h.__onClick=function(t,e,i){var s,r=null==(s=e.objects.find((function(t){return t.userData.psvMarker})))?void 0:s.userData.psvMarker;r||(r=this.__getTargetMarker(e.target,!0)),r?(this.prop.currentMarker=r,this.trigger(a.SELECT_MARKER,r,{dblclick:i,rightclick:e.rightclick}),this.config.clickEventOnMarker?e.marker=r:t.stopPropagation(),this.markers[r.id]&&this.showMarkerPanel(r.id)):this.prop.currentMarker&&(this.trigger(a.UNSELECT_MARKER,this.prop.currentMarker),this.psv.panel.hide(c),this.prop.currentMarker=null)},h.__refreshUi=function(){var t=Object.values(this.markers).filter((function(t){return!t.config.hideList})).length,e=this.psv.navbar.getButton(y.id,!1),i=this.psv.navbar.getButton(m.id,!1);0===t?(null==e||e.hide(),null==i||i.hide(),(this.psv.panel.isVisible(u)||this.psv.panel.isVisible(c))&&this.psv.panel.hide()):(null==e||e.show(),null==i||i.show(),this.psv.panel.isVisible(u)?this.showMarkersList():this.psv.panel.isVisible(c)&&(this.prop.currentMarker?this.showMarkerPanel(this.prop.currentMarker):this.psv.panel.hide()))},h.__checkObjectsObserver=function(){var t=Object.values(this.markers).some((function(t){return t.is3d()}));!t&&this.prop.stopObserver?(this.prop.stopObserver(),this.prop.stopObserver=null):t&&!this.prop.stopObserver&&(this.prop.stopObserver=this.psv.observeObjects(p,this))},o}(i.AbstractPlugin);E.id="markers",E.EVENTS=a,t.EVENTS=a,t.MarkersPlugin=E,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=/sm/52ca393b77d28ebb9971a5fc6a6ea00088b4825bcf8c7f78830e9261c92df6a8.map